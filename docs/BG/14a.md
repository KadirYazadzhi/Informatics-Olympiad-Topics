# üîô Backtracking (–¢—ä—Ä—Å–µ–Ω–µ —Å –≤—Ä—ä—â–∞–Ω–µ)

Backtracking –µ –∞–ª–≥–æ—Ä–∏—Ç–º–∏—á–Ω–∞ —Ç–µ—Ö–Ω–∏–∫–∞ –∑–∞ —Ä–µ—à–∞–≤–∞–Ω–µ –Ω–∞ –∑–∞–¥–∞—á–∏ —á—Ä–µ–∑ –ø—ä–ª–Ω–æ –∏–∑—á–µ—Ä–ø–≤–∞–Ω–µ (brute-force), –∫–æ—è—Ç–æ –∏–∑–≥—Ä–∞–∂–¥–∞ —Ä–µ—à–µ–Ω–∏–µ—Ç–æ —Å—Ç—ä–ø–∫–∞ –ø–æ —Å—Ç—ä–ø–∫–∞ –∏ —Å–µ "–≤—Ä—ä—â–∞ –Ω–∞–∑–∞–¥" (backtracks), –≤–µ–¥–Ω–∞–≥–∞ —â–æ–º —É—Å—Ç–∞–Ω–æ–≤–∏, —á–µ —Ç–µ–∫—É—â–∏—è—Ç –ø—ä—Ç –Ω–µ –≤–æ–¥–∏ –¥–æ –≤–∞–ª–∏–¥–Ω–æ —Ä–µ—à–µ–Ω–∏–µ.

## 1. –û–±—â–∞ —Å—Ö–µ–º–∞

Backtracking –µ –ø–æ —Å—ä—â–µ—Å—Ç–≤–æ –î—ä–ª–±–æ–∫–æ –û–±—Ö–æ–∂–¥–∞–Ω–µ (DFS) –≤ –¥—ä—Ä–≤–æ—Ç–æ –Ω–∞ —Å—ä—Å—Ç–æ—è–Ω–∏—è—Ç–∞.

```cpp
void backtrack(State current) {
    if (isSolution(current)) {
        printSolution(current);
        return;
    }

    for (Option opt : getOptions(current)) {
        if (isValid(current, opt)) {
            makeMove(current, opt); // –ù–∞–ø—Ä–µ–¥
            backtrack(current);     // –†–µ–∫—É—Ä—Å–∏—è
            undoMove(current, opt); // –ù–∞–∑–∞–¥ (Backtrack)
        }
    }
}
```

## 2. –ö–ª–∞—Å–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ—Ä–∏

### 2.1. –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–µ—Ä–º—É—Ç–∞—Ü–∏–∏
–î–∞ —Å–µ –Ω–∞–º–µ—Ä—è—Ç –≤—Å–∏—á–∫–∏ –Ω–∞—Ä–µ–¥–±–∏ –Ω–∞ —á–∏—Å–ª–∞—Ç–∞ –æ—Ç 1 –¥–æ N.

```cpp
int n;
vector<int> p;
bool used[20];

void permutations() {
    if (p.size() == n) {
        for (int x : p) cout << x << " ";
        cout << endl;
        return;
    }
    for (int i = 1; i <= n; i++) {
        if (!used[i]) {
            used[i] = true;
            p.push_back(i);
            permutations();
            p.pop_back(); // Backtrack
            used[i] = false;
        }
    }
}
```

### 2.2. –ó–∞–¥–∞—á–∞—Ç–∞ –∑–∞ N-—Ç–µ —Ü–∞—Ä–∏—Ü–∏
–î–∞ —Å–µ —Ä–∞–∑–ø–æ–ª–æ–∂–∞—Ç $N$ —Ü–∞—Ä–∏—Ü–∏ –Ω–∞ –¥—ä—Å–∫–∞ $N \times N$, —Ç–∞–∫–∞ —á–µ –¥–∞ –Ω–µ —Å–µ –±–∏—è—Ç.
*   –ò–∑–ø–æ–ª–∑–≤–∞–º–µ –º–∞—Å–∏–≤–∏ `col`, `diag1`, `diag2`, –∑–∞ –¥–∞ —Å–ª–µ–¥–∏–º –∑–∞–µ—Ç–∏—Ç–µ –ª–∏–Ω–∏–∏ –∑–∞ $O(1)$.
*   `diag1`: $row + col = const$
*   `diag2`: $row - col + N = const$

```cpp
int n, ans = 0;
bool col[20], d1[40], d2[40];

void solve(int r) {
    if (r == n) {
        ans++;
        return;
    }
    for (int c = 0; c < n; c++) {
        if (!col[c] && !d1[r + c] && !d2[r - c + n]) {
            col[c] = d1[r + c] = d2[r - c + n] = true;
            solve(r + 1);
            col[c] = d1[r + c] = d2[r - c + n] = false; // Backtrack
        }
    }
}
```

### 2.3. –ì–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞
–ó–∞ –≤—Å—è–∫–∞ –µ–ª–µ–º–µ–Ω—Ç –∏–º–∞–º–µ –¥–≤–∞ –∏–∑–±–æ—Ä–∞: –¥–∞ –≥–æ –≤–∑–µ–º–µ–º –∏–ª–∏ –¥–∞ –Ω–µ –≥–æ –≤–∑–µ–º–µ–º.
–°–ª–æ–∂–Ω–æ—Å—Ç: $O(2^N)$.

## 3. –û–∫–∞—Å—Ç—Ä—è–Ω–µ (Pruning)

–ù–∞–π-–≤–∞–∂–Ω–∞—Ç–∞ —á–∞—Å—Ç –æ—Ç Backtracking –µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è—Ç–∞. –ê–∫–æ —Å–º–µ —Å–∏–≥—É—Ä–Ω–∏, —á–µ —Ç–µ–∫—É—â–∏—è—Ç –∫–ª–æ–Ω –Ω—è–º–∞ –¥–∞ –¥–∞–¥–µ —Ä–µ—à–µ–Ω–∏–µ (–∏–ª–∏ –ø–æ-–¥–æ–±—Ä–æ –æ—Ç –≤–µ—á–µ –Ω–∞–º–µ—Ä–µ–Ω–æ—Ç–æ), —Å–ø–∏—Ä–∞–º–µ –≤–µ–¥–Ω–∞–≥–∞.
*   –ü—Ä–∏–º–µ—Ä: –í –∑–∞–¥–∞—á–∞—Ç–∞ –∑–∞ —Ä–∞–Ω–∏—Ü–∞—Ç–∞, –∞–∫–æ —Ç–µ–∫—É—â–æ—Ç–æ —Ç–µ–≥–ª–æ –Ω–∞–¥–≤–∏—à–∞–≤–∞ –∫–∞–ø–∞—Ü–∏—Ç–µ—Ç–∞, –≤—Ä—ä—â–∞–º–µ —Å–µ.
*   –ü—Ä–∏–º–µ—Ä: –í TSP (–¢—ä—Ä–≥–æ–≤—Å–∫–∏—è –ø—ä—Ç–Ω–∏–∫), –∞–∫–æ —Ç–µ–∫—É—â–∏—è—Ç –ø—ä—Ç –≤–µ—á–µ –µ –ø–æ-–¥—ä–ª—ä–≥ –æ—Ç –Ω–∞–π-–¥–æ–±—Ä–∏—è –Ω–∞–º–µ—Ä–µ–Ω –¥–æ –º–æ–º–µ–Ω—Ç–∞, —Å–ø–∏—Ä–∞–º–µ.

## 4. –°–ª–æ–∂–Ω–æ—Å—Ç

Backtracking –∞–ª–≥–æ—Ä–∏—Ç–º–∏—Ç–µ —á–µ—Å—Ç–æ –∏–º–∞—Ç –µ–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç ($O(N!)$, $O(2^N)$, $O(K^N)$).
*   –ü–æ–¥—Ö–æ–¥—è—â–∏ —Å–∞ –∑–∞ $N \le 20$ (–∑–∞ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞) –∏–ª–∏ $N \le 10$ (–∑–∞ –ø–µ—Ä–º—É—Ç–∞—Ü–∏–∏).
*   –ê–∫–æ $N$ –µ –ø–æ-–≥–æ–ª—è–º–æ, —Ç—ä—Ä—Å–µ—Ç–µ –î–∏–Ω–∞–º–∏—á–Ω–æ –ø—Ä–æ–≥—Ä–∞–º–∏—Ä–∞–Ω–µ –∏–ª–∏ Greedy.

## 5. –ó–∞–¥–∞—á–∏
1.  **UVa 750**: 8 Queens Chess Problem.
2.  **Sudoku Solver**: –ö–ª–∞—Å–∏—á–µ—Å–∫–∏ backtracking.
3.  **Codeforces 1285B**: Just Eat It! (–º–æ–∂–µ –¥–∞ —Å–µ —Ä–µ—à–∏ –∏ —Å Greedy, –Ω–æ –º–∞–ª–∫–∏—Ç–µ constraints –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç BT).
4.  **Knight's Tour**: –û–±—Ö–æ–∂–¥–∞–Ω–µ –Ω–∞ –¥—ä—Å–∫–∞ —Å –∫–æ–Ω.

## üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
–í–∏–Ω–∞–≥–∏ –ø–æ–º–Ω–µ—Ç–µ –¥–∞ –≤—ä–∑—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ (`undoMove`) —Å–ª–µ–¥ –≤—Ä—ä—â–∞–Ω–µ –æ—Ç —Ä–µ–∫—É—Ä—Å–∏—è—Ç–∞. –¢–æ–≤–∞ –µ –Ω–∞–π-—á–µ—Å—Ç–∞—Ç–∞ –≥—Ä–µ—à–∫–∞.