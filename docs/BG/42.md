# üî§ –°—É—Ñ–∏–∫—Å–Ω–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏: –ï–∫—Å–ø–µ—Ä—Ç–Ω–æ –Ω–∏–≤–æ

–°—É—Ñ–∏–∫—Å–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Å–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –∑–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –Ω–∏–∑–æ–≤–µ. –¢–µ –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç –±—ä—Ä–∑–∏ –æ—Ç–≥–æ–≤–æ—Ä–∏ –Ω–∞ –∑–∞—è–≤–∫–∏ –∫–∞—Ç–æ "–¥–∞–ª–∏ –Ω–∏–∑ $P$ —Å–µ —Å—ä–¥—ä—Ä–∂–∞ –≤ $S$", "–∫–æ–ª–∫–æ –ø—ä—Ç–∏ —Å–µ —Å—Ä–µ—â–∞", "–Ω–∞–º–µ—Ä–µ—Ç–µ –Ω–∞–π-–¥—ä–ª–≥–∏—è –æ–±—â –ø–æ–¥–Ω–∏–∑" –∏ –¥—Ä.

–û—Å–Ω–æ–≤–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ —Å–∞:
1.  **–°—É—Ñ–∏–∫—Å–Ω–æ –¥—ä—Ä–≤–æ (Suffix Tree)**.
2.  **–°—É—Ñ–∏–∫—Å–µ–Ω –º–∞—Å–∏–≤ (Suffix Array)**.
3.  **–°—É—Ñ–∏–∫—Å–µ–Ω –∞–≤—Ç–æ–º–∞—Ç (Suffix Automaton - SAM)**.

–í —Å—ä—Å—Ç–µ–∑–∞—Ç–µ–ª–Ω–æ—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–∏—Ä–∞–Ω–µ –Ω–∞–π-—á–µ—Å—Ç–æ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç **–°—É—Ñ–∏–∫—Å–µ–Ω –º–∞—Å–∏–≤** (–∑–∞—Ä–∞–¥–∏ –Ω–∏—Å–∫–∞—Ç–∞ –ø–∞–º–µ—Ç –∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞) –∏ **–°—É—Ñ–∏–∫—Å–µ–Ω –∞–≤—Ç–æ–º–∞—Ç** (–∑–∞—Ä–∞–¥–∏ —Å–≤–æ—è—Ç–∞ –º–æ—â–Ω–æ—Å—Ç –∏ –ª–∏–Ω–µ–π–Ω–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç).

---

## 1. –°—É—Ñ–∏–∫—Å–µ–Ω –º–∞—Å–∏–≤ (Suffix Array)

### 1.1. –î–µ—Ñ–∏–Ω–∏—Ü–∏—è
–ù–µ–∫–∞ $S$ –µ –Ω–∏–∑ —Å –¥—ä–ª–∂–∏–Ω–∞ $n$. –°—É—Ñ–∏–∫—Å–Ω–∏—è—Ç –º–∞—Å–∏–≤ `SA` —Å—ä–¥—ä—Ä–∂–∞ –∏–Ω–¥–µ–∫—Å–∏—Ç–µ –Ω–∞ –≤—Å–∏—á–∫–∏ —Å—É—Ñ–∏–∫—Å–∏ –Ω–∞ $S$, —Å–æ—Ä—Ç–∏—Ä–∞–Ω–∏ –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ—Å–∫–∏.
–ü—Ä–∏–º–µ—Ä: $S = "aba"$
–°—É—Ñ–∏–∫—Å–∏:
0: "aba"
1: "ba"
2: "a"

–°–æ—Ä—Ç–∏—Ä–∞–Ω–∏ —Å—É—Ñ–∏–∫—Å–∏:
1. "a" (–∏–Ω–¥–µ–∫—Å 2)
2. "aba" (–∏–Ω–¥–µ–∫—Å 0)
3. "ba" (–∏–Ω–¥–µ–∫—Å 1)
$\implies SA = [2, 0, 1]$.

### 1.2. –ü–æ—Å—Ç—Ä–æ—è–≤–∞–Ω–µ ($O(N \log N)$)
–ù–∞–π-–ø—Ä–æ—Å—Ç–∏—è—Ç –Ω–∞—á–∏–Ω –µ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ —Å—ä—Å `std::sort` ($O(N^2 \log N)$), –Ω–æ –µ —Ç–≤—ä—Ä–¥–µ –±–∞–≤–Ω–æ. –ï—Ñ–µ–∫—Ç–∏–≤–Ω–∏—è—Ç –ø–æ–¥—Ö–æ–¥ –∏–∑–ø–æ–ª–∑–≤–∞ —Å–æ—Ä—Ç–∏—Ä–∞–Ω–µ —á—Ä–µ–∑ –∫–ª–∞—Å–æ–≤–µ –Ω–∞ –µ–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç –Ω–∞ —Å—Ç–µ–ø–µ–Ω–∏ –Ω–∞ 2.

–ò–¥–µ—è:
1.  –°–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ–¥–Ω–∏–∑–æ–≤–µ —Å –¥—ä–ª–∂–∏–Ω–∞ $2^0 = 1$ (–ø—Ä–æ—Å—Ç–æ —Å–∏–º–≤–æ–ª–∏—Ç–µ).
2.  –ò–∑–ø–æ–ª–∑–≤–∞–º–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–∞, –∑–∞ –¥–∞ —Å–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ–¥–Ω–∏–∑–æ–≤–µ —Å –¥—ä–ª–∂–∏–Ω–∞ $2^1 = 2$. –ü–æ–¥–Ω–∏–∑ —Å –¥—ä–ª–∂–∏–Ω–∞ $2L$ —Å–µ —Å—ä—Å—Ç–æ–∏ –æ—Ç –¥–≤–∞ –ø–æ–¥–Ω–∏–∑–∞ —Å –¥—ä–ª–∂–∏–Ω–∞ $L$: `pair(class[i], class[i+L])`.
3.  –ü–æ–≤—Ç–∞—Ä—è–º–µ –¥–æ $2^k \ge n$.

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <string>

using namespace std;

vector<int> sort_cyclic_shifts(string const& s) {
    int n = s.size();
    const int alphabet = 256;
    vector<int> p(n), c(n), cnt(max(alphabet, n), 0);

    // –ù–∞—á–∞–ª–Ω–∞ —Ñ–∞–∑–∞ (k=0)
    for (int i = 0; i < n; i++) cnt[s[i]]++;
    for (int i = 1; i < alphabet; i++) cnt[i] += cnt[i-1];
    for (int i = 0; i < n; i++) p[--cnt[s[i]]] = i;
    
    c[p[0]] = 0;
    int classes = 1;
    for (int i = 1; i < n; i++) {
        if (s[p[i]] != s[p[i-1]]) classes++;
        c[p[i]] = classes - 1;
    }

    // –°—Ç—ä–ø–∫–∏ (1, 2, 4, ...)
    vector<int> pn(n), cn(n);
    for (int h = 0; (1 << h) < n; ++h) {
        for (int i = 0; i < n; i++) {
            pn[i] = p[i] - (1 << h);
            if (pn[i] < 0) pn[i] += n;
        }
        
        fill(cnt.begin(), cnt.begin() + classes, 0);
        for (int i = 0; i < n; i++) cnt[c[pn[i]]]++;
        for (int i = 1; i < classes; i++) cnt[i] += cnt[i-1];
        for (int i = n-1; i >= 0; i--) p[--cnt[c[pn[i]]]] = pn[i];
        
        cn[p[0]] = 0;
        classes = 1;
        for (int i = 1; i < n; i++) {
            pair<int, int> cur = {c[p[i]], c[(p[i] + (1 << h)) % n]};
            pair<int, int> prev = {c[p[i-1]], c[(p[i-1] + (1 << h)) % n]};
            if (cur != prev) ++classes;
            cn[p[i]] = classes - 1;
        }
        c.swap(cn);
    }
    return p;
}

vector<int> suffix_array_construction(string s) {
    s += "$"; // –î–æ–±–∞–≤—è–º–µ —Ç–µ—Ä–º–∏–Ω–∏—Ä–∞—â —Å–∏–º–≤–æ–ª (–Ω–∞–π-–º–∞–ª—ä–∫)
    vector<int> sorted_shifts = sort_cyclic_shifts(s);
    sorted_shifts.erase(sorted_shifts.begin()); // –ú–∞—Ö–∞–º–µ '$'
    return sorted_shifts;
}
```

### 1.3. LCP –ú–∞—Å–∏–≤ (Longest Common Prefix)
`LCP[i]` –µ –¥—ä–ª–∂–∏–Ω–∞—Ç–∞ –Ω–∞ –Ω–∞–π-–¥—ä–ª–≥–∏—è –æ–±—â –ø—Ä–µ—Ñ–∏–∫—Å –º–µ–∂–¥—É —Å—É—Ñ–∏–∫—Å–∏—Ç–µ `SA[i]` –∏ `SA[i-1]`.
–¢–æ–∑–∏ –º–∞—Å–∏–≤ –ø–æ–∑–≤–æ–ª—è–≤–∞ —Ä–µ—à–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ –º–Ω–æ–≥–æ –∑–∞–¥–∞—á–∏. –ú–æ–∂–µ –¥–∞ —Å–µ –ø–æ—Å—Ç—Ä–æ–∏ –∑–∞ $O(N)$ —á—Ä–µ–∑ –∞–ª–≥–æ—Ä–∏—Ç—ä–º–∞ –Ω–∞ –ö–∞—Å–∞–π (Kasai).

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ SA + LCP:
1.  **–ë—Ä–æ–π —Ä–∞–∑–ª–∏—á–Ω–∏ –ø–æ–¥–Ω–∏–∑–æ–≤–µ**: $\frac{n(n+1)}{2} - \sum LCP[i]$.
2.  **–ù–∞–π-–¥—ä–ª—ä–≥ –ø–æ–≤—Ç–∞—Ä—è—â —Å–µ –ø–æ–¥–Ω–∏–∑**: $\max(LCP)$.

---

## 2. –°—É—Ñ–∏–∫—Å–µ–Ω –∞–≤—Ç–æ–º–∞—Ç (Suffix Automaton - SAM)

### 2.1. –ò–¥–µ—è
SAM –µ –æ—Ä–∏–µ–Ω—Ç–∏—Ä–∞–Ω –∞—Ü–∏–∫–ª–∏—á–µ–Ω –≥—Ä–∞—Ñ (DAG), –∫–æ–π—Ç–æ –∫–æ–º–ø—Ä–µ—Å–∏—Ä–∞ –≤—Å–∏—á–∫–∏ –ø–æ–¥–Ω–∏–∑–æ–≤–µ –Ω–∞ –¥–∞–¥–µ–Ω –Ω–∏–∑.
*   **–í—ä–∑–ª–∏ (States)**: –í—Å–µ–∫–∏ –≤—ä–∑–µ–ª –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–≤–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç –ø–æ–¥–Ω–∏–∑–æ–≤–µ, –∫–æ–∏—Ç–æ —Å–µ —Å—Ä–µ—â–∞—Ç –Ω–∞ –µ–¥–Ω–∏ –∏ —Å—ä—â–∏ –ø–æ–∑–∏—Ü–∏–∏ –≤ $S$ (—Ç.–Ω–∞—Ä. `endpos` –µ–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç).
*   **–†–µ–±—Ä–∞**: –ü—Ä–µ—Ö–æ–¥–∏ –ø—Ä–∏ –¥–æ–±–∞–≤—è–Ω–µ –Ω–∞ —Å–∏–º–≤–æ–ª.
*   **Suffix Links**: –ü—Ä–µ–ø—Ä–∞—Ç–∫–∏ –∫—ä–º —Å—ä—Å—Ç–æ—è–Ω–∏–µ—Ç–æ, –æ—Ç–≥–æ–≤–∞—Ä—è—â–æ –Ω–∞ –Ω–∞–π-–¥—ä–ª–≥–∏—è —Å—É—Ñ–∏–∫—Å, –∫–æ–π—Ç–æ –µ –≤ –¥—Ä—É–≥ –∫–ª–∞—Å –Ω–∞ –µ–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç.

### 2.2. –°–≤–æ–π—Å—Ç–≤–∞
*   –ë—Ä–æ–π –≤—ä–∑–ª–∏: –Ω–∞–π-–º–Ω–æ–≥–æ $2N - 1$.
*   –ë—Ä–æ–π —Ä–µ–±—Ä–∞: –Ω–∞–π-–º–Ω–æ–≥–æ $3N - 4$.
*   –ü–æ—Å—Ç—Ä–æ—è–≤–∞–Ω–µ: $O(N)$ (–æ–Ω–ª–∞–π–Ω –∞–ª–≥–æ—Ä–∏—Ç—ä–º).

### 2.3. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è
–°—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞ –Ω–∞ –≤—ä–∑–µ–ª–∞ —Å—ä–¥—ä—Ä–∂–∞:
*   `len`: –¥—ä–ª–∂–∏–Ω–∞—Ç–∞ –Ω–∞ –Ω–∞–π-–¥—ä–ª–≥–∏—è –ø–æ–¥–Ω–∏–∑ –≤ —Ç–æ–≤–∞ —Å—ä—Å—Ç–æ—è–Ω–∏–µ.
*   `link`: —Å—É—Ñ–∏–∫—Å–Ω–∞ –≤—Ä—ä–∑–∫–∞.
*   `next`: map –∏–ª–∏ –º–∞—Å–∏–≤ –∑–∞ –ø—Ä–µ—Ö–æ–¥–∏—Ç–µ.

```cpp
#include <map>

struct State {
    int len, link;
    std::map<char, int> next; // –ò–ª–∏ –º–∞—Å–∏–≤ next[26]
};

const int MAXLEN = 100000;
State st[MAXLEN * 2];
int sz, last;

void sam_init() {
    st[0].len = 0;
    st[0].link = -1;
    st[0].next.clear();
    sz = 1;
    last = 0;
}

void sam_extend(char c) {
    int cur = sz++;
    st[cur].len = st[last].len + 1;
    st[cur].next.clear();
    
    int p = last;
    // –°–ª–µ–¥–≤–∞–º–µ —Å—É—Ñ–∏–∫—Å–Ω–∏—Ç–µ –≤—Ä—ä–∑–∫–∏, –¥–æ–∫–∞—Ç–æ –Ω—è–º–∞ –ø—Ä–µ—Ö–æ–¥ —Å 'c'
    while (p != -1 && st[p].next.find(c) == st[p].next.end()) {
        st[p].next[c] = cur;
        p = st[p].link;
    }
    
    if (p == -1) {
        st[cur].link = 0;
    } else {
        int q = st[p].next[c];
        if (st[p].len + 1 == st[q].len) {
            // –õ–µ—Å–µ–Ω —Å–ª—É—á–∞–π: –ø—Ä–æ—Å—Ç–æ —Å–≤—ä—Ä–∑–≤–∞–º–µ
            st[cur].link = q;
        } else {
            // –ö–ª–æ–Ω–∏—Ä–∞–Ω–µ
            int clone = sz++;
            st[clone].len = st[p].len + 1;
            st[clone].next = st[q].next; // –ö–æ–ø–∏—Ä–∞–º–µ –ø—Ä–µ—Ö–æ–¥–∏—Ç–µ
            st[clone].link = st[q].link;
            
            while (p != -1 && st[p].next[c] == q) {
                st[p].next[c] = clone;
                p = st[p].link;
            }
            st[q].link = st[cur].link = clone;
        }
    }
    last = cur;
}
```

### 2.4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ SAM

1.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ —Å—Ä–µ—â–∞–Ω–µ –Ω–∞ –ø–æ–¥–Ω–∏–∑**: –¢—Ä—ä–≥–≤–∞–º–µ –æ—Ç –∫–æ—Ä–µ–Ω–∞ –∏ —Å–ª–µ–¥–≤–∞–º–µ —Ä–µ–±—Ä–∞—Ç–∞. –ê–∫–æ –Ω–µ –º–æ–∂–µ–º –¥–∞ –Ω–∞–ø—Ä–∞–≤–∏–º –ø—Ä–µ—Ö–æ–¥, –Ω–∏–∑—ä—Ç –Ω–µ —Å–µ —Å—Ä–µ—â–∞. –í—Ä–µ–º–µ: $O(|P|)$.
2.  **–ë—Ä–æ–π —Ä–∞–∑–ª–∏—á–Ω–∏ –ø–æ–¥–Ω–∏–∑–æ–≤–µ**: –í—Å–µ–∫–∏ –≤—ä–∑–µ–ª $u$ (–æ—Å–≤–µ–Ω –∫–æ—Ä–µ–Ω–∞) –æ—Ç–≥–æ–≤–∞—Ä—è –Ω–∞ $len(u) - len(link(u))$ —É–Ω–∏–∫–∞–ª–Ω–∏ –ø–æ–¥–Ω–∏–∑–∞. –°—É–º–∏—Ä–∞–º–µ —Ç–∞–∑–∏ —Ä–∞–∑–ª–∏–∫–∞ –∑–∞ –≤—Å–∏—á–∫–∏ –≤—ä–∑–ª–∏.
3.  **–ù–∞–π-–º–∞–ª—ä–∫ —Ü–∏–∫–ª–∏—á–µ–Ω —à–∏—Ñ—Ç (Lexicographically Minimal String Rotation)**: –ü–æ—Å—Ç—Ä–æ—è–≤–∞–º–µ SAM –∑–∞ –Ω–∏–∑–∞ $S+S$ –∏ –≤—ä—Ä–≤–∏–º $N$ —Å—Ç—ä–ø–∫–∏ –ø–æ –Ω–∞–π-–º–∞–ª–∫–∏—Ç–µ –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ—Å–∫–∏ —Ä–µ–±—Ä–∞.
4.  **–ë—Ä–æ–π —Å—Ä–µ—â–∞–Ω–∏—è**: –ó–∞ –≤—Å–µ–∫–∏ –≤—ä–∑–µ–ª –º–æ–∂–µ–º –¥–∞ –ø—Ä–µ—Å–º–µ—Ç–Ω–µ–º –∫–æ–ª–∫–æ –ø—ä—Ç–∏ —Å–µ —Å—Ä–µ—â–∞—Ç –ø–æ–¥–Ω–∏–∑–æ–≤–µ—Ç–µ –º—É, –∫–∞—Ç–æ "–∏–∑–±—É—Ç–∞–º–µ" –±—Ä–æ—è—á–∏—Ç–µ –æ—Ç –¥–µ—Ü–∞—Ç–∞ –∫—ä–º —Ä–æ–¥–∏—Ç–µ–ª–∏—Ç–µ –≤ –¥—ä—Ä–≤–æ—Ç–æ –Ω–∞ —Å—É—Ñ–∏–∫—Å–Ω–∏—Ç–µ –≤—Ä—ä–∑–∫–∏ (link tree).

## 3. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Suffix Array + LCP | Suffix Automaton |
| :--- | :--- | :--- |
| **–ü–∞–º–µ—Ç** | $O(N)$ (–º–∞–ª–∫–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞, int –º–∞—Å–∏–≤–∏) | $O(N \Sigma)$ –∏–ª–∏ $O(N)$ —Å map (–ø–æ-–≥–æ–ª—è–º–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞) |
| **–í—Ä–µ–º–µ –∑–∞ —Å—Ç—Ä–æ–µ–Ω–µ** | $O(N \log N)$ –∏–ª–∏ $O(N)$ | $O(N)$ |
| **–°–ª–æ–∂–Ω–æ—Å—Ç –Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è** | –°—Ä–µ–¥–Ω–∞ (–º–∞–ª–∫–æ –æ–±—ä—Ä–∫–≤–∞—â–∞) | –ö—Ä–∞—Ç–∫–∞, –Ω–æ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω–∞ |
| **–ì—ä–≤–∫–∞–≤–æ—Å—Ç** | –î–æ–±—Ä–∞ –∑–∞ —Å—Ç–∞—Ç–∏—á–Ω–∏ –∑–∞–¥–∞—á–∏ | –û—Ç–ª–∏—á–Ω–∞, –ø–æ–¥–¥—ä—Ä–∂–∞ –¥–∏–Ω–∞–º–∏—á–Ω–æ –¥–æ–±–∞–≤—è–Ω–µ |

–ó–∞ —Å—ä—Å—Ç–µ–∑–∞–Ω–∏—è –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ **Suffix Array** –µ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞–Ω, –∞–∫–æ –ø–∞–º–µ—Ç—Ç–∞ –µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∞ (–Ω–∞–ø—Ä. 256MB –∑–∞ $N=5 \cdot 10^5$), –¥–æ–∫–∞—Ç–æ **SAM** –µ –ø–æ-—É–¥–æ–±–µ–Ω –∑–∞ –∑–∞–¥–∞—á–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Ä–∞–∑–ª–∏—á–Ω–∏ –Ω–∏–∑–æ–≤–µ –∏–ª–∏ —Å–ª–æ–∂–Ω–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏.
