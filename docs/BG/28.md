# üé≤ –ù–∞–ø—Ä–µ–¥–Ω–∞–ª–∞ –ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞: –ü—Ä–∏–Ω—Ü–∏–ø–∏ –∏ –¢–µ—Ö–Ω–∏–∫–∏ –∑–∞ –ë—Ä–æ–µ–Ω–µ

–ö–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞—Ç–∞ –≤ —Å—ä—Å—Ç–µ–∑–∞—Ç–µ–ª–Ω–æ—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–∏—Ä–∞–Ω–µ —á–µ—Å—Ç–æ –Ω–∞–¥—Ö–≤—ä—Ä–ª—è –ø—Ä–æ—Å—Ç–æ—Ç–æ –ø—Ä–µ—Å–º—è—Ç–∞–Ω–µ –Ω–∞ –ø–µ—Ä–º—É—Ç–∞—Ü–∏–∏ –∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏. –¢—è –∏–∑–∏—Å–∫–≤–∞ —Ä–∞–∑–±–∏—Ä–∞–Ω–µ –Ω–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª–Ω–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏, –∫–æ–∏—Ç–æ –ø–æ–∑–≤–æ–ª—è–≤–∞—Ç —Ä–µ—à–∞–≤–∞–Ω–µ—Ç–æ –Ω–∞ —Å–ª–æ–∂–Ω–∏ –∑–∞–¥–∞—á–∏ —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Å–∏–º–µ—Ç—Ä–∏–∏.

---

## 1. –ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞ –í–∫–ª—é—á–≤–∞–Ω–µ –∏ –ò–∑–∫–ª—é—á–≤–∞–Ω–µ (PIE)

–ü—Ä–∏–Ω—Ü–∏–ø—ä—Ç —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ –Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –≥–æ–ª–µ–º–∏–Ω–∞—Ç–∞ –Ω–∞ –æ–±–µ–¥–∏–Ω–µ–Ω–∏–µ—Ç–æ –Ω–∞ –∫—Ä–∞–µ–Ω –±—Ä–æ–π –∫—Ä–∞–π–Ω–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞.

### 1.1. –§–æ—Ä–º—É–ª–∏ –∑–∞ 2 –∏ 3 –º–Ω–æ–∂–µ—Å—Ç–≤–∞
*   $|A \cup B| = |A| + |B| - |A \cap B|$
*   $|A \cup B \cup C| = |A| + |B| + |C| - (|A \cap B| + |A \cap C| + |B \cap C|) + |A \cap B \cap C|$

### 1.2. –û–±—â–∞ –§–æ—Ä–º—É–ª–∞
–ó–∞ $n$ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ $A_1, A_2, \dots, A_n$:
$$\left| \bigcup_{i=1}^n A_i \right| = \sum_{i} |A_i| - \sum_{i < j} |A_i \cap A_j| + \sum_{i < j < k} |A_i \cap A_j \cap A_k| - \dots + (-1)^{n-1} |A_1 \cap \dots \cap A_n|$$

### 1.3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ü—Ä–æ–±–ª–µ–º—ä—Ç –∑–∞ –¥–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç–∏—Ç–µ ($D_n$)
–î–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç –µ –ø–µ—Ä–º—É—Ç–∞—Ü–∏—è, –ø—Ä–∏ –∫–æ—è—Ç–æ –Ω–∏—Ç–æ –µ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç –Ω–µ –µ –Ω–∞ "–ø—Ä–∞–≤–∏–ª–Ω–æ—Ç–æ" —Å–∏ –º—è—Å—Ç–æ (–Ω–∞–ø—Ä. –ø–∏—Å–º–æ $i$ –Ω–µ –µ –≤ –ø–ª–∏–∫ $i$).
–ò–∑–ø–æ–ª–∑–≤–∞–π–∫–∏ PIE, –∫—ä–¥–µ—Ç–æ "–ª–æ—à–æ—Ç–æ" —Å–≤–æ–π—Å—Ç–≤–æ $P_i$ –µ "–µ–ª–µ–º–µ–Ω—Ç $i$ –µ –Ω–∞ –ø–æ–∑–∏—Ü–∏—è $i$":
$$D_n = n! \sum_{k=0}^n \frac{(-1)^k}{k!}$$ 
–†–µ–∫—É—Ä—Å–∏—è: $D_n = (n-1)(D_{n-1} + D_{n-2})$.

### 1.4. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞ –¥–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç–∏:

```cpp
#include <iostream>
#include <vector>
using namespace std;

const long long MOD = 1e9 + 7;

// –ò–∑—á–∏—Å–ª—è–≤–∞–Ω–µ –Ω–∞ —Ñ–∞–∫—Ç–æ—Ä–∏–µ–ª
long long factorial(int n) {
    long long result = 1;
    for (int i = 2; i <= n; i++) {
        result = (result * i) % MOD;
    }
    return result;
}

// –ú–æ–¥—É–ª–Ω–æ –æ–±—Ä–∞—Ç–Ω–æ
long long modinv(long long a, long long m) {
    long long result = 1, base = a, exp = m - 2;
    while (exp > 0) {
        if (exp % 2 == 1) result = (result * base) % m;
        base = (base * base) % m;
        exp /= 2;
    }
    return result;
}

// –î–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç–∏ —á—Ä–µ–∑ PIE
long long derangements_PIE(int n) {
    long long fact = factorial(n);
    long long sum = 0;
    long long fact_k = 1;
    
    for (int k = 0; k <= n; k++) {
        long long term = (fact * modinv(fact_k, MOD)) % MOD;
        if (k % 2 == 0) {
            sum = (sum + term) % MOD;
        } else {
            sum = (sum - term + MOD) % MOD;
        }
        fact_k = (fact_k * (k + 1)) % MOD;
    }
    
    return sum;
}

// –î–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç–∏ —á—Ä–µ–∑ —Ä–µ–∫—É—Ä—Å–∏—è (–ø–æ-–±—ä—Ä–∑–æ)
long long derangements_DP(int n) {
    if (n == 0) return 1;
    if (n == 1) return 0;
    
    vector<long long> dp(n + 1);
    dp[0] = 1;
    dp[1] = 0;
    
    for (int i = 2; i <= n; i++) {
        dp[i] = ((i - 1) * ((dp[i-1] + dp[i-2]) % MOD)) % MOD;
    }
    
    return dp[n];
}

int main() {
    int n = 5;
    cout << "–î–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç–∏ –Ω–∞ " << n << " –µ–ª–µ–º–µ–Ω—Ç–∞: " 
         << derangements_DP(n) << endl;
    return 0;
}
```

### 1.5. –ó–∞–¥–∞—á–∞: –ë—Ä–æ–π –ø–µ—Ä–º—É—Ç–∞—Ü–∏–∏ —Å —Ç–æ—á–Ω–æ k —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏ —Ç–æ—á–∫–∏

```cpp
long long permWithKFixed(int n, int k) {
    // C(n, k) * D(n-k)
    // –ò–∑–±–∏—Ä–∞–º–µ k –µ–ª–µ–º–µ–Ω—Ç–∞ –¥–∞ —Å–∞ –Ω–∞ –º—è—Å—Ç–æ, –æ—Å—Ç–∞–Ω–∞–ª–∏—Ç–µ n-k —Å–∞ –¥–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç
    long long comb = binomial(n, k); // –¢—Ä—è–±–≤–∞ –¥–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞—Ç–µ binomial
    long long der = derangements_DP(n - k);
    return (comb * der) % MOD;
}
```

---

## 2. –ó–≤–µ–∑–¥–∏ –∏ –ß–µ—Ä—Ç–∏ (Stars and Bars)

–¢–∞–∑–∏ —Ç–µ—Ö–Ω–∏–∫–∞ –µ –±–µ–∑—Ü–µ–Ω–Ω–∞ –∑–∞ –∑–∞–¥–∞—á–∏ –æ—Ç —Ç–∏–ø–∞ "—Ä–∞–∑–ø—Ä–µ–¥–µ–ª—è–Ω–µ –Ω–∞ –∏–¥–µ–Ω—Ç–∏—á–Ω–∏ –ø—Ä–µ–¥–º–µ—Ç–∏ –≤ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫—É—Ç–∏–∏".

### 2.1. –í–∞—Ä–∏–∞–Ω—Ç 1: –ö—É—Ç–∏–∏—Ç–µ –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç –ø—Ä–∞–∑–Ω–∏
–ë—Ä–æ—è—Ç –Ω–∞—á–∏–Ω–∏ –¥–∞ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª–∏–º $n$ –µ–¥–Ω–∞–∫–≤–∏ —Ç–æ–ø—á–µ—Ç–∞ –≤ $k$ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫—É—Ç–∏–∏ –µ:
$$\binom{n + k - 1}{k - 1}$$
*–õ–æ–≥–∏–∫–∞*: –ò–º–∞–º–µ $n$ –∑–≤–µ–∑–¥–∏ –∏ $k-1$ —á–µ—Ä—Ç–∏ (—Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–∏). –û–±—â–æ $n+k-1$ –æ–±–µ–∫—Ç–∞. –ò–∑–±–∏—Ä–∞–º–µ –∫–æ–∏ $k-1$ –æ—Ç —Ç—è—Ö –¥–∞ —Å–∞ —á–µ—Ä—Ç–∏.

### 2.2. –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Å—è–∫–∞ –∫—É—Ç–∏—è —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –ø–æ–Ω–µ 1 –ø—Ä–µ–¥–º–µ—Ç
–ë—Ä–æ—è—Ç –Ω–∞—á–∏–Ω–∏ –µ:
$$\binom{n - 1}{k - 1}$$
*–õ–æ–≥–∏–∫–∞*: –ü–æ—Å—Ç–∞–≤—è–º–µ —á–µ—Ä—Ç–∏—Ç–µ –≤ –ø—Ä–∞–∑–Ω–∏—Ç–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ *–º–µ–∂–¥—É* –∑–≤–µ–∑–¥–∏—Ç–µ. –ò–º–∞ $n-1$ —Ç–∞–∫–∏–≤–∞ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.

### 2.3. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:

```cpp
// –ë–∏–Ω–æ–º–Ω–∏ –∫–æ–µ—Ñ–∏—Ü–∏–µ–Ω—Ç–∏ —Å –î–ü
const int MAXN = 1005;
const long long MOD = 1e9 + 7;
long long C[MAXN][MAXN];

void precompute_binomial() {
    for (int i = 0; i < MAXN; i++) {
        C[i][0] = C[i][i] = 1;
        for (int j = 1; j < i; j++) {
            C[i][j] = (C[i-1][j-1] + C[i-1][j]) % MOD;
        }
    }
}

// –í–∞—Ä–∏–∞–Ω—Ç 1: –ö—É—Ç–∏–∏—Ç–µ –º–æ–≥–∞—Ç –¥–∞ –±—ä–¥–∞—Ç –ø—Ä–∞–∑–Ω–∏
long long starsAndBars1(int n, int k) {
    return C[n + k - 1][k - 1];
}

// –í–∞—Ä–∏–∞–Ω—Ç 2: –í—Å—è–∫–∞ –∫—É—Ç–∏—è —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–º–∞ –ø–æ–Ω–µ 1
long long starsAndBars2(int n, int k) {
    if (n < k) return 0; // –ù–µ–≤—ä–∑–º–æ–∂–Ω–æ
    return C[n - 1][k - 1];
}

// –í–∞—Ä–∏–∞–Ω—Ç 3: –í—Å—è–∫–∞ –∫—É—Ç–∏—è –∏–º–∞ min –∏ max
long long starsAndBarsWithLimits(int n, int k, vector<int>& minVals, vector<int>& maxVals) {
    // –ü—ä—Ä–≤–æ –æ—Ç–¥–µ–ª—è–º–µ –º–∏–Ω–∏–º–∞–ª–Ω–∏—Ç–µ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏
    int remaining = n;
    for (int i = 0; i < k; i++) {
        remaining -= minVals[i];
    }
    
    if (remaining < 0) return 0;
    
    // –ò–∑–ø–æ–ª–∑–≤–∞–º–µ PIE –∑–∞ –º–∞–∫—Å–∏–º–∞–ª–Ω–∏—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    // –¢–æ–≤–∞ –µ –ø–æ-—Å–ª–æ–∂–Ω–æ –∏ –∏–∑–∏—Å–∫–≤–∞ –≥–µ–Ω–µ—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –≤—Å–∏—á–∫–∏ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞
    // ... (–æ—Å—Ç–∞–≤–µ–Ω–æ –∫–∞—Ç–æ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ)
    return 0; // placeholder
}
```

### 2.4. –ü—Ä–∏–º–µ—Ä–Ω–∞ –∑–∞–¥–∞—á–∞:

**–ó–∞–¥–∞—á–∞**: –ü–æ –∫–æ–ª–∫–æ –Ω–∞—á–∏–Ω–∞ –º–æ–∂–µ–º –¥–∞ —Ä–∞–∑–¥–µ–ª–∏–º $n$ –µ–¥–Ω–∞–∫–≤–∏ –±–æ–Ω–±–æ–Ω–∞ –º–µ–∂–¥—É $k$ –¥–µ—Ü–∞, –∞–∫–æ –≤—Å—è–∫–æ –¥–µ—Ç–µ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–ª—É—á–∏ –ø–æ–Ω–µ 2 –±–æ–Ω–±–æ–Ω–∞?

**–†–µ—à–µ–Ω–∏–µ**: 
1. –î–∞–≤–∞–º–µ –Ω–∞ –≤—Å—è–∫–æ –¥–µ—Ç–µ –ø–æ 2 –±–æ–Ω–±–æ–Ω–∞: –æ—Å—Ç–∞–≤–∞—Ç $n - 2k$ –±–æ–Ω–±–æ–Ω–∞
2. –†–∞–∑–ø—Ä–µ–¥–µ–ª—è–º–µ –æ—Å—Ç–∞–≤–∞—â–∏—Ç–µ –±–æ–Ω–±–æ–Ω–∏ –ø—Ä–æ–∏–∑–≤–æ–ª–Ω–æ: $\binom{(n-2k) + k - 1}{k-1} = \binom{n - k - 1}{k - 1}$

```cpp
long long distributeCandies(int n, int k) {
    if (n < 2 * k) return 0; // –ù–µ–≤—ä–∑–º–æ–∂–Ω–æ
    return C[n - k - 1][k - 1];
}
```

---

## 3. –õ–µ–º–∞ –Ω–∞ –ë—ä—Ä–Ω—Å–∞–π–¥ (Burnside's Lemma)

–ò–∑–ø–æ–ª–∑–≤–∞ —Å–µ –∑–∞ –±—Ä–æ–µ–Ω–µ –Ω–∞ **—Ä–∞–∑–ª–∏—á–Ω–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–µ –Ω–∞ –≥—Ä—É–ø–∞ –æ—Ç —Å–∏–º–µ—Ç—Ä–∏–∏ (—Ä–æ—Ç–∞—Ü–∏–∏, –æ—Ç—Ä–∞–∂–µ–Ω–∏—è).

**–§–æ—Ä–º—É–ª–∞**:
$$N = \frac{1}{|G|} \sum_{g \in G} |X^g|$$
–ö—ä–¥–µ—Ç–æ:
*   $|G|$ –µ –±—Ä–æ—è—Ç –Ω–∞ —Å–∏–º–µ—Ç—Ä–∏–∏—Ç–µ (–Ω–∞–ø—Ä. —Ä–æ—Ç–∞—Ü–∏—è –Ω–∞ 0, 90, 180, 270 –≥—Ä–∞–¥—É—Å–∞).
*   $|X^g|$ –µ –±—Ä–æ—è—Ç –Ω–∞ –æ—Ü–≤–µ—Ç—è–≤–∞–Ω–∏—è—Ç–∞, –∫–æ–∏—Ç–æ –Ω–µ —Å–µ –ø—Ä–æ–º–µ–Ω—è—Ç —Å–ª–µ–¥ –ø—Ä–∏–ª–∞–≥–∞–Ω–µ –Ω–∞ —Å–∏–º–µ—Ç—Ä–∏—è—Ç–∞ $g$.

### –ü—Ä–∏–º–µ—Ä: –û–≥—ä—Ä–ª–∏—Ü–∞ —Å $n$ –º—ä–Ω–∏—Å—Ç–∞ –∏ $m$ —Ü–≤—è—Ç–∞ (—Å–∞–º–æ —Ä–æ—Ç–∞—Ü–∏–∏)
$|G| = n$ (–≤—Å–∏—á–∫–∏ –≤—ä–∑–º–æ–∂–Ω–∏ –∑–∞–≤—ä—Ä—Ç–∞–Ω–∏—è).
–ó–∞ –≤—Å—è–∫–∞ —Ä–æ—Ç–∞—Ü–∏—è —Å $k$ —Å—Ç—ä–ø–∫–∏, –±—Ä–æ—è—Ç –Ω–∞ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏—Ç–µ –æ—Ü–≤–µ—Ç—è–≤–∞–Ω–∏—è –µ $m^{\gcd(k, n)}$.
–û–±—â–æ: $N = \frac{1}{n} \sum_{k=0}^{n-1} m^{\gcd(k, n)}$.

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:

```cpp
#include <iostream>
#include <cmath>
using namespace std;

long long gcd(long long a, long long b) {
    return b == 0 ? a : gcd(b, a % b);
}

long long power(long long base, long long exp, long long mod) {
    long long result = 1;
    base %= mod;
    while (exp > 0) {
        if (exp & 1) result = (result * base) % mod;
        base = (base * base) % mod;
        exp >>= 1;
    }
    return result;
}

long long modinv(long long a, long long m) {
    return power(a, m - 2, m);
}

// –ë—Ä–æ–µ–Ω–µ –Ω–∞ –æ–≥—ä—Ä–ª–∏—Ü–∏ —Å n –º—ä–Ω–∏—Å—Ç–∞ –∏ m —Ü–≤—è—Ç–∞ (—Å–∞–º–æ —Ä–æ—Ç–∞—Ü–∏–∏)
long long necklaceRotations(int n, int m, long long MOD) {
    long long sum = 0;
    for (int k = 0; k < n; k++) {
        long long g = gcd(k, n);
        sum = (sum + power(m, g, MOD)) % MOD;
    }
    return (sum * modinv(n, MOD)) % MOD;
}

// –û–≥—ä—Ä–ª–∏—Ü–∞ —Å —Ä–æ—Ç–∞—Ü–∏–∏ –ò –æ—Ç—Ä–∞–∂–µ–Ω–∏—è (Polya enumeration)
long long necklaceWithReflections(int n, int m, long long MOD) {
    long long rotations = 0;
    for (int k = 0; k < n; k++) {
        rotations = (rotations + power(m, gcd(k, n), MOD)) % MOD;
    }
    
    long long reflections = 0;
    if (n % 2 == 1) {
        // n –Ω–∞ –±—Ä–æ–π –æ—Å–∏ –ø—Ä–µ–∑ –µ–¥–∏–Ω –≤—Ä—ä—Ö
        reflections = (n * power(m, (n + 1) / 2, MOD)) % MOD;
    } else {
        // n/2 –æ—Å–∏ –ø—Ä–µ–∑ –¥–≤–∞ –≤—ä—Ä—Ö–∞ + n/2 –æ—Å–∏ –º–µ–∂–¥—É –≤—ä—Ä—Ö–æ–≤–µ
        long long axis1 = (n / 2) * power(m, n / 2 + 1, MOD) % MOD;
        long long axis2 = (n / 2) * power(m, n / 2, MOD) % MOD;
        reflections = (axis1 + axis2) % MOD;
    }
    
    long long total = (rotations + reflections) % MOD;
    long long groupSize = 2 * n; // n —Ä–æ—Ç–∞—Ü–∏–∏ + n –æ—Ç—Ä–∞–∂–µ–Ω–∏—è
    
    return (total * modinv(groupSize, MOD)) % MOD;
}

int main() {
    int n = 6; // 6 –º—ä–Ω–∏—Å—Ç–∞
    int m = 3; // 3 —Ü–≤—è—Ç–∞
    long long MOD = 1e9 + 7;
    
    cout << "–û–≥—ä—Ä–ª–∏—Ü–∏ (—Å–∞–º–æ —Ä–æ—Ç–∞—Ü–∏–∏): " 
         << necklaceRotations(n, m, MOD) << endl;
    cout << "–û–≥—ä—Ä–ª–∏—Ü–∏ (—Ä–æ—Ç–∞—Ü–∏–∏ + –æ—Ç—Ä–∞–∂–µ–Ω–∏—è): " 
         << necklaceWithReflections(n, m, MOD) << endl;
    
    return 0;
}
```

### –î—Ä—É–≥ –ø—Ä–∏–º–µ—Ä: –û—Ü–≤–µ—Ç—è–≤–∞–Ω–µ –Ω–∞ –∫—É–±

–ö—É–± –∏–º–∞ 24 —Å–∏–º–µ—Ç—Ä–∏–∏ (–µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞ –≥—Ä—É–ø–∞—Ç–∞ –Ω–∞ —Ä–æ—Ç–∞—Ü–∏–∏—Ç–µ):
- 1 –∏–¥–µ–Ω—Ç–∏—Ç–µ—Ç: –≤—Å–∏—á–∫–∏ $m^6$ –æ—Ü–≤–µ—Ç—è–≤–∞–Ω–∏—è —Å–∞ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏
- 6 —Ä–æ—Ç–∞—Ü–∏–∏ –Ω–∞ 90¬∞ –æ–∫–æ–ª–æ –æ—Å–∏ –ø—Ä–µ–∑ —Ü–µ–Ω—Ç—Ä–æ–≤–µ –Ω–∞ –ª–∏—Ü–∞: $m^3$ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏
- 3 —Ä–æ—Ç–∞—Ü–∏–∏ –Ω–∞ 180¬∞ –æ–∫–æ–ª–æ —Å—ä—â–∏—Ç–µ –æ—Å–∏: $m^4$ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏
- 8 —Ä–æ—Ç–∞—Ü–∏–∏ –Ω–∞ 120¬∞ –æ–∫–æ–ª–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏: $m^2$ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏
- 6 —Ä–æ—Ç–∞—Ü–∏–∏ –Ω–∞ 180¬∞ –æ–∫–æ–ª–æ –æ—Å–∏ –ø—Ä–µ–∑ —Å—Ä–µ–¥–∏—Ç–µ –Ω–∞ —Ä–µ–±—Ä–∞: $m^3$ —Ñ–∏–∫—Å–∏—Ä–∞–Ω–∏

$$N = \frac{1}{24}(m^6 + 6m^3 + 3m^4 + 8m^2 + 6m^3) = \frac{1}{24}(m^6 + 3m^4 + 12m^3 + 8m^2)$$

---

## 4. –¢–µ–æ—Ä–µ–º–∞ –Ω–∞ –õ—É–∫–∞—Å (Lucas Theorem)

–ü–æ–∑–≤–æ–ª—è–≤–∞ –±—ä—Ä–∑–æ –ø—Ä–µ—Å–º—è—Ç–∞–Ω–µ –Ω–∞ $\binom{n}{k} \pmod p$, –∫—ä–¥–µ—Ç–æ $p$ –µ **–º–∞–ª–∫–æ –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ**, –∞ $n$ –∏ $k$ —Å–∞ –æ–≥—Ä–æ–º–Ω–∏ (–¥–æ $10^{18}$).
–ê–∫–æ –∑–∞–ø–∏—à–µ–º $n$ –∏ $k$ –≤ $p$-–∏—á–Ω–∞ –±—Ä–æ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞:
$n = n_k p^k + \dots + n_0$
$k = k_k p^k + \dots + k_0$
–¢–æ:
$$\binom{n}{k} \equiv \prod_{i=0}^k \binom{n_i}{k_i} \pmod p$$

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è:

```cpp
const long long MOD = 1000000007; // –¢—Ä—è–±–≤–∞ –¥–∞ –µ –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ

// –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª–Ω–æ –∏–∑—á–∏—Å–ª—è–≤–∞–º–µ —Ñ–∞–∫—Ç–æ—Ä–∏–µ–ª–∏ –∏ –æ–±—Ä–∞—Ç–Ω–∏ –∑–∞ –º–∞–ª–∫–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏
long long fact[MOD], inv_fact[MOD];

void precompute_factorials() {
    fact[0] = 1;
    for (int i = 1; i < MOD; i++) {
        fact[i] = (fact[i-1] * i) % MOD;
    }
    
    inv_fact[MOD - 1] = power(fact[MOD - 1], MOD - 2, MOD);
    for (int i = MOD - 2; i >= 0; i--) {
        inv_fact[i] = (inv_fact[i + 1] * (i + 1)) % MOD;
    }
}

// –ë–∏–Ω–æ–º –∑–∞ –º–∞–ª–∫–∏ n, k
long long binomial_small(long long n, long long k) {
    if (k > n || k < 0) return 0;
    return (fact[n] * inv_fact[k] % MOD) * inv_fact[n - k] % MOD;
}

// –¢–µ–æ—Ä–µ–º–∞ –Ω–∞ –õ—É–∫–∞—Å
long long lucas(long long n, long long k, long long p) {
    if (k == 0) return 1;
    return (binomial_small(n % p, k % p) * lucas(n / p, k / p, p)) % p;
}

int main() {
    precompute_factorials();
    
    long long n = 1000000000000LL;
    long long k = 500000000000LL;
    
    cout << "C(" << n << ", " << k << ") mod " << MOD 
         << " = " << lucas(n, k, MOD) << endl;
    
    return 0;
}
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –±–∏–Ω–æ–º –µ —á–µ—Ç–Ω–æ/–Ω–µ—á–µ—Ç–Ω–æ

–ó–∞ $p = 2$, —Ç–µ–æ—Ä–µ–º–∞—Ç–∞ –Ω–∞ –õ—É–∫–∞—Å –¥–∞–≤–∞ –±—ä—Ä–∑ –Ω–∞—á–∏–Ω –¥–∞ –ø—Ä–æ–≤–µ—Ä–∏–º –¥–∞–ª–∏ $\binom{n}{k}$ –µ —á–µ—Ç–Ω–æ:
$\binom{n}{k}$ –µ –Ω–µ—á–µ—Ç–Ω–æ —Ç–æ–≥–∞–≤–∞ –∏ —Å–∞–º–æ —Ç–æ–≥–∞–≤–∞, –∫–æ–≥–∞—Ç–æ $(k \& n) = k$ (–≤—Å–∏—á–∫–∏ –±–∏—Ç–æ–≤–µ –Ω–∞ $k$ –ø—Ä–∏—Å—ä—Å—Ç–≤–∞—Ç –≤ $n$).

---

## 5. –§–æ—Ä–º—É–ª–∞ –Ω–∞ –ö–µ–π–ª–∏ (Cayley's Formula)

–ë—Ä–æ—è—Ç –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω–∏—Ç–µ –Ω–æ–º–µ—Ä–∏—Ä–∞–Ω–∏ –¥—ä—Ä–≤–µ—Ç–∞ —Å $n$ –≤—ä—Ä—Ö–∞ –µ $n^{n-2}$.
–°–≤—ä—Ä–∑–∞–Ω–∞ –µ —Å **–†–µ–¥–∏—Ü–∏—Ç–µ –Ω–∞ –ü—Ä—é—Ñ–µ—Ä (Prufer Sequences)** ‚Äì –≤—Å–µ–∫–∏ –Ω–∏–∑ –æ—Ç $n-2$ —á–∏—Å–ª–∞ –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ $[1, n]$ –∫–æ–¥–∏—Ä–∞ —É–Ω–∏–∫–∞–ª–Ω–æ –¥—ä—Ä–≤–æ.

### 5.1. –î–æ–∫–∞–∑–∞—Ç–µ–ª—Å—Ç–≤–æ —á—Ä–µ–∑ Prufer –∫–æ–¥–∏—Ä–∞–Ω–µ:

```cpp
// –ü—Ä–µ–≤—Ä—ä—â–∞–Ω–µ –Ω–∞ –¥—ä—Ä–≤–æ –≤ Prufer –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ—Å—Ç
vector<int> treeToPrufer(int n, vector<pair<int,int>>& edges) {
    vector<int> degree(n + 1, 0);
    vector<set<int>> adj(n + 1);
    
    for (auto [u, v] : edges) {
        adj[u].insert(v);
        adj[v].insert(u);
        degree[u]++;
        degree[v]++;
    }
    
    vector<int> prufer;
    for (int i = 0; i < n - 2; i++) {
        // –ù–∞–º–∏—Ä–∞–º–µ –ª–∏—Å—Ç–∞ —Å –Ω–∞–π-–º–∞–ª—ä–∫ –Ω–æ–º–µ—Ä
        for (int leaf = 1; leaf <= n; leaf++) {
            if (degree[leaf] == 1) {
                int neighbor = *adj[leaf].begin();
                prufer.push_back(neighbor);
                
                // –ü—Ä–µ–º–∞—Ö–≤–∞–º–µ —Ä–µ–±—Ä–æ
                degree[leaf]--;
                degree[neighbor]--;
                adj[leaf].erase(neighbor);
                adj[neighbor].erase(leaf);
                break;
            }
        }
    }
    
    return prufer;
}

// –ü—Ä–µ–≤—Ä—ä—â–∞–Ω–µ –Ω–∞ Prufer –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ—Å—Ç –≤ –¥—ä—Ä–≤–æ
vector<pair<int,int>> pruferToTree(vector<int>& prufer) {
    int n = prufer.size() + 2;
    vector<int> degree(n + 1, 1);
    
    for (int node : prufer) {
        degree[node]++;
    }
    
    vector<pair<int,int>> edges;
    for (int i : prufer) {
        // –ù–∞–º–∏—Ä–∞–º–µ –Ω–∞–π-–º–∞–ª–∫–æ—Ç–æ –ª–∏—Å—Ç–æ
        for (int leaf = 1; leaf <= n; leaf++) {
            if (degree[leaf] == 1) {
                edges.push_back({i, leaf});
                degree[i]--;
                degree[leaf]--;
                break;
            }
        }
    }
    
    // –°–≤—ä—Ä–∑–≤–∞–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ –¥–≤–µ –ª–∏—Å—Ç–∞
    for (int u = 1; u <= n; u++) {
        if (degree[u] == 1) {
            for (int v = u + 1; v <= n; v++) {
                if (degree[v] == 1) {
                    edges.push_back({u, v});
                    break;
                }
            }
            break;
        }
    }
    
    return edges;
}
```

### 5.2. –û–±–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ñ–æ—Ä–º—É–ª–∞—Ç–∞ –Ω–∞ –ö–µ–π–ª–∏:

–ë—Ä–æ—è—Ç –Ω–∞ –≥–æ—Ä–∏ —Å $n$ –≤—ä—Ä—Ö–∞ –∏ $k$ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ (–¥—ä—Ä–≤–µ—Ç–∞) –µ: $k \cdot n^{n-k-1}$

### 5.3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ë—Ä–æ–π –Ω–∞—á–∏–Ω–∏ –¥–∞ —Å–≤—ä—Ä–∂–µ–º –≥—Ä–∞–¥–æ–≤–µ

**–ó–∞–¥–∞—á–∞**: –ò–º–∞–º–µ $n$ –≥—Ä–∞–¥–∞. –ö–æ–ª–∫–æ –Ω–∞—á–∏–Ω–∞ –∏–º–∞ –¥–∞ –≥–∏ —Å–≤—ä—Ä–∂–µ–º —Å $n-1$ –ø—ä—Ç—è, —Ç–∞–∫–∞ —á–µ –≤—Å–µ–∫–∏ –≥—Ä–∞–¥ –¥–∞ –µ –¥–æ—Å—Ç—ä–ø–µ–Ω –æ—Ç –≤—Å–µ–∫–∏ –¥—Ä—É–≥?

**–û—Ç–≥–æ–≤–æ—Ä**: $n^{n-2}$ (—Ñ–æ—Ä–º—É–ª–∞ –Ω–∞ –ö–µ–π–ª–∏)

---

## 6. –ó–∞–¥–∞—á–∏ –∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ
1.  **CSES Distributing Apples**: Stars and Bars.
2.  **Codeforces 451E**: PIE —Å –≥–æ–ª–µ–º–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (–∏–∑–∏—Å–∫–≤–∞ Lucas –∏–ª–∏ —Ö–∏—Ç—Ä–æ –±—Ä–æ–µ–Ω–µ).
3.  **CSES Christmas Party**: –î–µ—Ä–∞–Ω–∂–∏–º–µ–Ω—Ç–∏.
4.  **UVa 10294**: Necklace (Burnside).
5.  **SPOJ ADACABAA**: Binomial coefficients modulo composite (Lucas).
6.  **Codeforces 711D**: Colored Tree (Burnside + Prufer).

## 7. –ö–∞—Ç–∞–ª–∞–Ω–æ–≤–∏ —á–∏—Å–ª–∞

–ö–∞—Ç–∞–ª–∞–Ω–æ–≤–∏—Ç–µ —á–∏—Å–ª–∞ $C_n$ –∏–º–∞—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:

$$C_n = \frac{1}{n+1}\binom{2n}{n} = \frac{(2n)!}{(n+1)!n!}$$

### –†–µ–∫—É—Ä—Å–∏—è:
$$C_0 = 1, \quad C_{n+1} = \sum_{i=0}^{n} C_i C_{n-i}$$

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
1. –ë—Ä–æ–π –≤–∞–ª–∏–¥–Ω–∏ —Å–∫–æ–±–æ–≤–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª–Ω–æ—Å—Ç–∏ —Å $n$ –¥–≤–æ–π–∫–∏ —Å–∫–æ–±–∏
2. –ë—Ä–æ–π –¥–≤–æ–∏—á–Ω–∏ –¥—ä—Ä–≤–µ—Ç–∞ —Å $n$ –≤—ä—Ç—Ä–µ—à–Ω–∏ –≤—ä–∑–µ–ª–∞
3. –ë—Ä–æ–π –Ω–∞—á–∏–Ω–∏ –¥–∞ —Ç—Ä–∏–∞–Ω–≥—É–ª–∏—Ä–∞–º–µ –º–Ω–æ–≥–æ—ä–≥—ä–ª–Ω–∏–∫ —Å $n+2$ –≤—ä—Ä—Ö–∞
4. –ë—Ä–æ–π –ø—ä—Ç–∏—â–∞ –≤ —Ä–µ—à–µ—Ç–∫–∞ –æ—Ç $(0,0)$ –¥–æ $(n,n)$, –∫–æ–∏—Ç–æ –Ω–µ –ø—Ä–µ—Å–∏—á–∞—Ç –¥–∏–∞–≥–æ–Ω–∞–ª–∞

```cpp
vector<long long> catalan(int n, long long MOD) {
    vector<long long> C(n + 1);
    C[0] = 1;
    
    for (int i = 0; i < n; i++) {
        C[i + 1] = 0;
        for (int j = 0; j <= i; j++) {
            C[i + 1] = (C[i + 1] + C[j] * C[i - j]) % MOD;
        }
    }
    
    return C;
}

// –ü–æ-–µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ –≤–µ—Ä—Å–∏—è —Å –±–∏–Ω–æ–º–Ω–∏ –∫–æ–µ—Ñ–∏—Ü–∏–µ–Ω—Ç–∏
long long catalan_fast(int n, long long MOD) {
    long long binom = binomial(2 * n, n); // C(2n, n)
    return (binom * modinv(n + 1, MOD)) % MOD;
}
```

## 8. –ß–∏—Å–ª–∞ –Ω–∞ –°—Ç–∏—Ä–ª–∏–Ω–≥

### –ß–∏—Å–ª–∞ –Ω–∞ –°—Ç–∏—Ä–ª–∏–Ω–≥ –æ—Ç –ø—ä—Ä–≤–∏ —Ä–æ–¥ $S_1(n, k)$:
–ë—Ä–æ—è—Ç –Ω–∞—á–∏–Ω–∏ –¥–∞ —Ä–∞–∑–¥–µ–ª–∏–º $n$ –µ–ª–µ–º–µ–Ω—Ç–∞ –≤ $k$ —Ü–∏–∫—ä–ª–∞.

### –ß–∏—Å–ª–∞ –Ω–∞ –°—Ç–∏—Ä–ª–∏–Ω–≥ –æ—Ç –≤—Ç–æ—Ä–∏ —Ä–æ–¥ $S_2(n, k)$:
–ë—Ä–æ—è—Ç –Ω–∞—á–∏–Ω–∏ –¥–∞ —Ä–∞–∑–¥–µ–ª–∏–º $n$ –µ–ª–µ–º–µ–Ω—Ç–∞ –≤ $k$ –Ω–µ–ø—Ä–∞–∑–Ω–∏ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞.

–†–µ–∫—É—Ä—Å–∏—è: $S_2(n, k) = k \cdot S_2(n-1, k) + S_2(n-1, k-1)$

```cpp
long long stirling2[MAXN][MAXN];

void compute_stirling2(int n) {
    stirling2[0][0] = 1;
    for (int i = 1; i <= n; i++) {
        for (int j = 1; j <= i; j++) {
            stirling2[i][j] = (j * stirling2[i-1][j] + stirling2[i-1][j-1]) % MOD;
        }
    }
}
```

### –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –°—Ç–∏—Ä–ª–∏–Ω–≥:
–ë—Ä–æ—è—Ç –Ω–∞ —Å—é—Ä–µ–∫—Ç–∏–≤–Ω–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å $n$ –µ–ª–µ–º–µ–Ω—Ç–∞ –∫—ä–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å $k$ –µ–ª–µ–º–µ–Ω—Ç–∞ –µ: $k! \cdot S_2(n, k)$

## üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ù–∞–ø—Ä–µ–¥–Ω–∞–ª–∞—Ç–∞ –∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞ —á–µ—Å—Ç–æ —Å–µ —Å–≤–µ–∂–¥–∞ –¥–æ —Ç–æ–≤–∞ –¥–∞ —Ä–∞–∑–ø–æ–∑–Ω–∞–µ—Ç–µ –∫–æ–π –ø—Ä–∏–Ω—Ü–∏–ø –¥–∞ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ. PIE –µ –∑–∞ –∑–∞–¥–∞—á–∏ —Å "–ø–æ–Ω–µ –µ–¥–Ω–æ" –∏–ª–∏ "–Ω–∏—Ç–æ –µ–¥–Ω–æ", Stars and Bars –µ –∑–∞ —Ä–∞–∑–ø—Ä–µ–¥–µ–ª—è–Ω–µ –Ω–∞ —Ä–µ—Å—É—Ä—Å–∏, –∞ Burnside –µ –∑–∞ —Å–∏–º–µ—Ç—Ä–∏—è. –ü—Ä–∞–∫—Ç–∏–∫—É–≤–∞–π—Ç–µ —Å —Ä–∞–∑–ª–∏—á–Ω–∏ –∑–∞–¥–∞—á–∏, –∑–∞ –¥–∞ —Ä–∞–∑–≤–∏–µ—Ç–µ –∏–Ω—Ç—É–∏—Ü–∏—è.