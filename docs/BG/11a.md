# üìê –ü—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏—Ü–∏ –∏ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∞ –ì–µ–æ–º–µ—Ç—Ä–∏—è

–ó–∞–¥–∞—á–∏—Ç–µ —Å –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏—Ü–∏, —á–∏–∏—Ç–æ —Å—Ç—Ä–∞–Ω–∏ —Å–∞ —É—Å–ø–æ—Ä–µ–¥–Ω–∏ –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–Ω–∏—Ç–µ –æ—Å–∏ (Axis-Aligned Bounding Box - AABB), —Å–∞ –∏–∑–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ —á–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏. –¢–µ —Å–∞ –æ—Å–Ω–æ–≤–∞—Ç–∞ –∑–∞ –ø–æ-—Å–ª–æ–∂–Ω–∏ –∞–ª–≥–æ—Ä–∏—Ç–º–∏ –∫–∞—Ç–æ Sweep-Line –∏ Segment Trees.

## 1. –ü—Ä–µ–¥—Å—Ç–∞–≤—è–Ω–µ

–ù–∞–π-—É–¥–æ–±–Ω–∏—è—Ç –Ω–∞—á–∏–Ω –∑–∞ —Å—ä—Ö—Ä–∞–Ω–µ–Ω–∏–µ –µ —á—Ä–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ –Ω–∞ –¥–æ–ª–Ω–∏—è –ª—è–≤ $(x_1, y_1)$ –∏ –≥–æ—Ä–Ω–∏—è –¥–µ—Å–µ–Ω $(x_2, y_2)$ –≤—Ä—ä—Ö.
–í–∞–∂–Ω–æ: –£–≤–µ—Ä–µ—Ç–µ —Å–µ, —á–µ $x_1 \le x_2$ –∏ $y_1 \le y_2$.

```cpp
struct Rect {
    long long x1, y1, x2, y2; // –ò–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ long long –∑–∞ –¥–∞ –∏–∑–±–µ–≥–Ω–µ—Ç–µ overflow –ø—Ä–∏ –ø–ª–æ—â

    long long width() const { return max(0LL, x2 - x1); }
    long long height() const { return max(0LL, y2 - y1); }
    long long area() const { return width() * height(); }
};
```

## 2. –û—Å–Ω–æ–≤–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 2.1. –°–µ—á–µ–Ω–∏–µ (Intersection)
–°–µ—á–µ–Ω–∏–µ—Ç–æ –Ω–∞ –¥–≤–∞ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫–∞ $A$ –∏ $B$ —Å—ä—â–æ –µ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫ (–∏–ª–∏ –ø—Ä–∞–∑–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ).
–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ –º—É —Å–µ –ø–æ–ª—É—á–∞–≤–∞—Ç —á—Ä–µ–∑ –≤–∑–µ–º–∞–Ω–µ –Ω–∞ "–≤—ä—Ç—Ä–µ—à–Ω–∏—Ç–µ" –≥—Ä–∞–Ω–∏—Ü–∏: `max` –æ—Ç –ª–µ–≤–∏—Ç–µ/–¥–æ–ª–Ω–∏—Ç–µ –∏ `min` –æ—Ç –¥–µ—Å–Ω–∏—Ç–µ/–≥–æ—Ä–Ω–∏—Ç–µ.

```cpp
Rect intersect(const Rect& a, const Rect& b) {
    Rect res;
    res.x1 = max(a.x1, b.x1);
    res.y1 = max(a.y1, b.y1);
    res.x2 = min(a.x2, b.x2);
    res.y2 = min(a.y2, b.y2);
    
    // –ê–∫–æ –µ –Ω–µ–≤–∞–ª–∏–¥–µ–Ω (—Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª–Ω–∏ —Å—Ç—Ä–∞–Ω–∏), –≤—Ä—ä—â–∞–º–µ –Ω—É–ª–µ–≤
    if (res.x1 >= res.x2 || res.y1 >= res.y2) 
        return {0, 0, 0, 0};
        
    return res;
}
```

### 2.2. –û–±–µ–¥–∏–Ω–µ–Ω–∏–µ (Union Area)
–ó–∞ —Ä–∞–∑–ª–∏–∫–∞ –æ—Ç —Å–µ—á–µ–Ω–∏–µ—Ç–æ, –æ–±–µ–¥–∏–Ω–µ–Ω–∏–µ—Ç–æ –Ω–∞ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏—Ü–∏ –Ω–µ –µ –Ω–µ–ø—Ä–µ–º–µ–Ω–Ω–æ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫. –û–±–∏–∫–Ω–æ–≤–µ–Ω–æ —Å–µ —Ç—ä—Ä—Å–∏ **–ø–ª–æ—â—Ç–∞ –Ω–∞ –æ–±–µ–¥–∏–Ω–µ–Ω–∏–µ—Ç–æ**.

**–ó–∞ 2 –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫–∞ (–ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞ –≤–∫–ª—é—á–≤–∞–Ω–µ –∏ –∏–∑–∫–ª—é—á–≤–∞–Ω–µ):**
$S(A \cup B) = S(A) + S(B) - S(A \cap B)$

**–ó–∞ 3 –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫–∞:**
$S(A \cup B \cup C) = S(A) + S(B) + S(C) - S(A \cap B) - S(A \cap C) - S(B \cap C) + S(A \cap B \cap C)$

–ó–∞ $N$ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫–∞ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –º–µ—Ç–æ–¥—ä—Ç –Ω–∞ **–ó–∞–º–∏—Ç–∞—â–∞—Ç–∞ –ø—Ä–∞–≤–∞ (Sweep Line)**, –∫–æ–π—Ç–æ –µ —Ä–∞–∑–≥–ª–µ–¥–∞–Ω –≤ –¢–µ–º–∞ 27.

### 2.3. –¢–æ—á–∫–∞ –≤ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫
```cpp
bool contains(const Rect& r, long long x, long long y) {
    return x >= r.x1 && x <= r.x2 && y >= r.y1 && y <= r.y2;
    // –í–Ω–∏–º–∞–≤–∞–π—Ç–µ —Å—ä—Å —Å—Ç—Ä–æ–≥–∏—Ç–µ –Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ (< vs <=) —Å–ø–æ—Ä–µ–¥ —É—Å–ª–æ–≤–∏–µ—Ç–æ
}
```

## 3. 2D –ü—Ä–µ—Ñ–∏–∫—Å–Ω–∏ –°—É–º–∏ (2D Prefix Sums)

–ê–∫–æ –∏–º–∞–º–µ –º–∞—Ç—Ä–∏—Ü–∞ $A$ —Å —á–∏—Å–ª–∞ –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∑–∞—è–≤–∫–∏ –∑–∞ —Å—É–º–∞—Ç–∞ –≤ –ø–æ–¥–ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫ $(x_1, y_1)$ –¥–æ $(x_2, y_2)$, –º–æ–∂–µ–º –¥–∞ –æ—Ç–≥–æ–≤–∞—Ä—è–º–µ –∑–∞ $O(1)$ —Å–ª–µ–¥ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å–∏–Ω–≥ $O(N \cdot M)$.

### –ü—Ä–µ–ø—Ä–æ—Ü–µ—Å–∏–Ω–≥
–°—ä–∑–¥–∞–≤–∞–º–µ –º–∞—Ç—Ä–∏—Ü–∞ `pref`, –∫—ä–¥–µ—Ç–æ `pref[i][j]` –ø–∞–∑–∏ —Å—É–º–∞—Ç–∞ –Ω–∞ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫–∞ –æ—Ç $(1, 1)$ –¥–æ $(i, j)$.
–§–æ—Ä–º—É–ª–∞ (–≤–∫–ª—é—á–≤–∞–Ω–µ-–∏–∑–∫–ª—é—á–≤–∞–Ω–µ):
`pref[i][j] = matrix[i][j] + pref[i-1][j] + pref[i][j-1] - pref[i-1][j-1]`

### –ó–∞—è–≤–∫–∞
–°—É–º–∞—Ç–∞ –≤ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫, –¥–µ—Ñ–∏–Ω–∏—Ä–∞–Ω –æ—Ç $(r1, c1)$ (–≥–æ—Ä–µ-–ª—è–≤–æ) –∏ $(r2, c2)$ (–¥–æ–ª—É-–¥—è—Å–Ω–æ):
`Sum = pref[r2][c2] - pref[r1-1][c2] - pref[r2][c1-1] + pref[r1-1][c1-1]`

```cpp
// –ü—Ä–∏–º–µ—Ä–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è (1-based index)
vector<vector<long long>> pref(N + 1, vector<long long>(M + 1, 0));
for (int i = 1; i <= N; i++) {
    for (int j = 1; j <= M; j++) {
        pref[i][j] = matrix[i][j] + pref[i-1][j] + pref[i][j-1] - pref[i-1][j-1];
    }
}
// –ó–∞—è–≤–∫–∞ –∑–∞ (r1, c1) –¥–æ (r2, c2)
long long query(int r1, int c1, int r2, int c2) {
    return pref[r2][c2] - pref[r1-1][c2] - pref[r2][c1-1] + pref[r1-1][c1-1];
}
```

## 4. –ö–æ–º–ø—Ä–µ—Å–∏—è –Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ (Coordinate Compression)

–ê–∫–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏—Ç–µ —Å–∞ –≥–æ–ª–µ–º–∏ (–Ω–∞–ø—Ä. –¥–æ $10^9$), –Ω–æ –±—Ä–æ—è—Ç –Ω–∞ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏—Ü–∏—Ç–µ $N$ –µ –º–∞–ª—ä–∫ (–Ω–∞–ø—Ä. $1000$), –Ω–µ –º–æ–∂–µ–º –¥–∞ —Å—ä–∑–¥–∞–¥–µ–º –º–∞—Ç—Ä–∏—Ü–∞ —Å —Ä–∞–∑–º–µ—Ä $10^9 \times 10^9$.
–ù–æ —Ä–µ–∞–ª–Ω–æ –≤–∞–∂–Ω–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ —Å–∞ —Å–∞–º–æ —Ç–µ–∑–∏, –∫—ä–¥–µ—Ç–æ –∑–∞–ø–æ—á–≤–∞ –∏–ª–∏ —Å–≤—ä—Ä—à–≤–∞ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏–∫ ($x_1$ –∏ $x_2$).
–ò–º–∞ –Ω–∞–π-–º–Ω–æ–≥–æ $2N$ —É–Ω–∏–∫–∞–ª–Ω–∏ X –∏ $2N$ —É–Ω–∏–∫–∞–ª–Ω–∏ Y –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏.

### –ê–ª–≥–æ—Ä–∏—Ç—ä–º:
1.  –°—ä–±–µ—Ä–µ—Ç–µ –≤—Å–∏—á–∫–∏ $x$ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤—ä–≤ –≤–µ–∫—Ç–æ—Ä `xs`.
2.  –°–æ—Ä—Ç–∏—Ä–∞–π—Ç–µ `xs` –∏ –ø—Ä–µ–º–∞—Ö–Ω–µ—Ç–µ –¥—É–±–ª–∏–∫–∞—Ç–∏—Ç–µ (`sort` + `unique`).
3.  –ó–∞–º–µ–Ω–µ—Ç–µ –≤—Å—è–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ $x$ –æ—Ç –≤—Ö–æ–¥–∞ —Å –Ω–µ–π–Ω–∏—è –∏–Ω–¥–µ–∫—Å –≤ `xs` (—á—Ä–µ–∑ `lower_bound`).
4.  –°–µ–≥–∞ —Ä–∞–±–æ—Ç–∏—Ç–µ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏ –≤ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞ $[0, 2N]$.

```cpp
vector<int> xs;
for (auto r : rects) { xs.push_back(r.x1); xs.push_back(r.x2); }
sort(xs.begin(), xs.end());
xs.erase(unique(xs.begin(), xs.end()), xs.end());

// Get compressed value
int compressed_x = lower_bound(xs.begin(), xs.end(), raw_x) - xs.begin();
// Get original value
int original_x = xs[compressed_x];
```

–¢–æ–≤–∞ –µ –∫–ª—é—á–æ–≤–∞ —Ç–µ—Ö–Ω–∏–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–∞ —Å—ä—Å SegTree –∏–ª–∏ Sweep Line –≤—ä—Ä—Ö—É –≥–æ–ª–µ–º–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏.

## 5. –ó–∞–¥–∞—á–∏
1.  **CSES Forest Queries**: –ö–ª–∞—Å–∏—á–µ—Å–∫–∞ –∑–∞–¥–∞—á–∞ –∑–∞ 2D –ø—Ä–µ—Ñ–∏–∫—Å–Ω–∏ —Å—É–º–∏.
2.  **Codeforces 1195C**: Basketball Exercise (–∏–º–∞ –≥–µ–æ–º–µ—Ç—Ä–∏—á–Ω–∏ –≤–∞—Ä–∏–∞—Ü–∏–∏).
3.  **IOI 2013 Dreaming**: –í–∫–ª—é—á–≤–∞ —Ä–∞–±–æ—Ç–∞ —Å –º–µ—Ç—Ä–∏–∫–∏.

**–°—ä–≤–µ—Ç**: –í–∏–Ω–∞–≥–∏ —Ä–∏—Å—É–≤–∞–π—Ç–µ —Å–ª—É—á–∞–∏—Ç–µ, –∫–æ–≥–∞—Ç–æ –ø—Ä–∞–≤–æ—ä–≥—ä–ª–Ω–∏—Ü–∏—Ç–µ –Ω–µ —Å–µ –ø—Ä–µ—Å–∏—á–∞—Ç, –∑–∞ –¥–∞ —Ä–∞–∑–±–µ—Ä–µ—Ç–µ —Ñ–æ—Ä–º—É–ª–∏—Ç–µ –∑–∞ `max` –∏ `min` –ø—Ä–∏ —Å–µ—á–µ–Ω–∏–µ—Ç–æ.