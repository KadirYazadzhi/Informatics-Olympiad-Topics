# üîó Union-Find (DSU): –†–∞–∑—à–∏—Ä–µ–Ω–∏ —Ç–µ—Ö–Ω–∏–∫–∏

## üîô DSU —Å Rollback (–í—Ä—ä—â–∞–Ω–µ –Ω–∞–∑–∞–¥)

–ü–æ–Ω—è–∫–æ–≥–∞ —Ç—Ä—è–±–≤–∞ –¥–∞ –¥–æ–±–∞–≤—è–º–µ —Ä–µ–±—Ä–∞, –¥–∞ –æ—Ç–≥–æ–≤–∞—Ä—è–º–µ –Ω–∞ –≤—ä–ø—Ä–æ—Å–∏ –∏ –ø–æ—Å–ª–µ –¥–∞ **–ø—Ä–µ–º–∞—Ö–≤–∞–º–µ** –ø–æ—Å–ª–µ–¥–Ω–∏—Ç–µ –¥–æ–±–∞–≤–µ–Ω–∏ —Ä–µ–±—Ä–∞ (–Ω–∞–ø—Ä. –ø—Ä–∏ Divide and Conquer –≤—ä—Ä—Ö—É –≤—Ä–µ–º–µ–≤–∞ –æ—Å).
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ—Ç–æ Path Compression –Ω–µ –ø–æ–∑–≤–æ–ª—è–≤–∞ –ª–µ—Å–Ω–æ –≤—Ä—ä—â–∞–Ω–µ.
- –ó–∞—Ç–æ–≤–∞ –∏–∑–ø–æ–ª–∑–≤–∞–º–µ **—Å–∞–º–æ Union by Rank/Size** (–±–µ–∑ Path Compression). –î—ä–ª–±–æ—á–∏–Ω–∞—Ç–∞ –Ω–∞ –¥—ä—Ä–≤–æ—Ç–æ –æ—Å—Ç–∞–≤–∞ $O(\log N)$.
- –ü–∞–∑–∏–º —Å—Ç–µ–∫ —Å –ø—Ä–æ–º–µ–Ω–∏—Ç–µ: "–í—Ä—ä—Ö $u$ –ø—Ä–æ–º–µ–Ω–∏ —Ä–æ–¥–∏—Ç–µ–ª—è —Å–∏ –æ—Ç $u$ –Ω–∞ $v$".
- `rollback()`: –í—Ä—ä—â–∞ –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –ø—Ä–æ–º—è–Ω–∞ –æ—Ç —Å—Ç–µ–∫–∞.

```cpp
struct DSU_Rollback {
    vector<int> parent, sz;
    vector<pair<int, int>> history; // {child, original_parent}

    // ... init ...

    int find(int i) { // –ë–µ–∑ path compression!
        if (parent[i] == i) return i;
        return find(parent[i]); 
    }

    void unite(int i, int j) {
        int root_i = find(i), root_j = find(j);
        if (root_i != root_j) {
            if (sz[root_i] < sz[root_j]) swap(root_i, root_j);
            parent[root_j] = root_i;
            sz[root_i] += sz[root_j];
            history.push_back({root_j, root_j}); // –ó–∞–ø–∏—Å–≤–∞–º–µ –∫–∞–∫–≤–æ —Å–º–µ –ø—Ä–æ–º–µ–Ω–∏–ª–∏
        } else {
            history.push_back({-1, -1}); // –ù–∏—â–æ –Ω–µ —Å–µ –ø—Ä–æ–º–µ–Ω–∏
        }
    }

    void rollback() {
        auto last = history.back(); history.pop_back();
        if (last.first != -1) {
            parent[last.first] = last.second;
            sz[last.second] -= sz[last.first];
        }
    }
};
```

---

## üå≤ DSU –≤—ä—Ä—Ö—É –¥—ä—Ä–≤–æ (Small-to-Large Merging)

–¢–µ—Ö–Ω–∏–∫–∞ –∑–∞ —Ä–µ—à–∞–≤–∞–Ω–µ –Ω–∞ –∑–∞–¥–∞—á–∏ –æ—Ç —Ç–∏–ø–∞ "–ó–∞ –≤—Å—è–∫–æ –ø–æ–¥–¥—ä—Ä–≤–æ –ø—Ä–µ–±—Ä–æ–π –∫–æ–ª–∫–æ —Ä–∞–∑–ª–∏—á–Ω–∏ —Ü–≤—è—Ç–∞ –∏–º–∞".
- –ò–¥–µ—è: –ü–æ–¥–¥—ä—Ä–∂–∞–º–µ `set` –æ—Ç —Ü–≤–µ—Ç–æ–≤–µ –∑–∞ –≤—Å–µ–∫–∏ –≤—ä–∑–µ–ª.
- –ö–æ–≥–∞—Ç–æ –æ–±–µ–¥–∏–Ω—è–≤–∞–º–µ `set`-–∞ –Ω–∞ –¥–µ—Ç–µ—Ç–æ —Å —Ç–æ–∑–∏ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è, –≤–∏–Ω–∞–≥–∏ –º–µ—Å—Ç–∏–º –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ –æ—Ç **–ø–æ-–º–∞–ª–∫–∏—è** –≤ **–ø–æ-–≥–æ–ª–µ–º–∏—è** set.
- –°–ª–æ–∂–Ω–æ—Å—Ç: –í—Å–µ–∫–∏ –µ–ª–µ–º–µ–Ω—Ç —Å–µ –º–µ—Å—Ç–∏ –Ω–∞–π-–º–Ω–æ–≥–æ $O(\log N)$ –ø—ä—Ç–∏. –û–±—â–æ $O(N \log^2 N)$.

---

## ‚öñÔ∏è DSU —Å —Ç–µ–≥–ª–∞ (Weighted DSU)

–û—Å–≤–µ–Ω –≤—Ä—ä–∑–∫–∞—Ç–∞ —Ä–æ–¥–∏—Ç–µ–ª-–¥–µ—Ç–µ, –ø–∞–∑–∏–º –∏ –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ —Ä–µ–±—Ä–æ—Ç–æ.
- –ü—Ä–∏–º–µ—Ä: –†–∞–∑–ª–∏–∫–∞ –≤ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∏—Ç–µ $val[u] - val[parent[u]]$.
- –ü—Ä–∏ `find` —Å Path Compression –æ–±–Ω–æ–≤—è–≤–∞–º–µ –∏ —Ç–∞–∑–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç.
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç –Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –æ—Ç —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞/–Ω–µ—Ä–∞–≤–µ–Ω—Å—Ç–≤–∞ ($A - B = 5$, $B - C = 3 \implies A - C = 8$).

---

## üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

DSU –µ –º–Ω–æ–≥–æ –ø–æ–≤–µ—á–µ –æ—Ç –ø—Ä–æ—Å—Ç–æ –Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏. –í–µ—Ä—Å–∏—è—Ç–∞ —Å Rollback –µ –∫–ª—é—á—ä—Ç –∫—ä–º —Ä–µ—à–∞–≤–∞–Ω–µ –Ω–∞ –¥–∏–Ω–∞–º–∏—á–Ω–∏ –∑–∞–¥–∞—á–∏, –∞ Small-to-Large merging –µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞ —Ç–µ—Ö–Ω–∏–∫–∞ –∑–∞ –∑–∞–¥–∞—á–∏ –≤—ä—Ä—Ö—É –¥—ä—Ä–≤–µ—Ç–∞. üöÄ