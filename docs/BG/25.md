# üîó –°–∏—Å—Ç–µ–º–∞ –æ—Ç –ù–µ–π–µ—Ä–∞—Ä—Ö–∏—á–Ω–∏ –ú–Ω–æ–∂–µ—Å—Ç–≤–∞ (Disjoint Set Union - DSU)

–°–∏—Å—Ç–µ–º–∞—Ç–∞ –æ—Ç –Ω–µ–π–µ—Ä–∞—Ä—Ö–∏—á–Ω–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ (–∏–∑–≤–µ—Å—Ç–Ω–∞ –æ—â–µ –∫–∞—Ç–æ Union-Find) –µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç –¥–∞–Ω–Ω–∏, –∫–æ—è—Ç–æ –ø–æ–¥–¥—ä—Ä–∂–∞ —Ä–∞–∑–¥–µ–ª—è–Ω–µ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –æ—Ç –µ–ª–µ–º–µ–Ω—Ç–∏ –Ω–∞ –Ω—è–∫–æ–ª–∫–æ –Ω–µ—Å–∏–º–µ—Ç—Ä–∏—á–Ω–∏ (–Ω–µ–π–µ—Ä–∞—Ä—Ö–∏—á–Ω–∏) –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞. –¢–∞–∑–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –µ –æ—Ç —Å—ä—â–µ—Å—Ç–≤–µ–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ –∑–∞ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Ç–æ —Ä–µ—à–∞–≤–∞–Ω–µ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ–±–ª–µ–º–∏, —Å–≤—ä—Ä–∑–∞–Ω–∏ —Å –≥—Ä–∞—Ñ–∏, –º—Ä–µ–∂–∏ –∏ –¥–∏–Ω–∞–º–∏—á–Ω–∞ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç.

DSU –µ –æ—Å–æ–±–µ–Ω–æ –ø–æ–ª–µ–∑–Ω–∞, –∫–æ–≥–∞—Ç–æ —Ç—Ä—è–±–≤–∞ –¥–∞ –ø–æ–¥–¥—ä—Ä–∂–∞–º–µ –∫–æ–ª–µ–∫—Ü–∏—è –æ—Ç –µ–ª–µ–º–µ–Ω—Ç–∏, —Ä–∞–∑–¥–µ–ª–µ–Ω–∏ –Ω–∞ –Ω–µ–ø—Ä–µ—Å–∏—á–∞—â–∏ —Å–µ –≥—Ä—É–ø–∏, –∏ –¥–∞ –æ—Ç–≥–æ–≤–∞—Ä—è–º–µ –±—ä—Ä–∑–æ –Ω–∞ –∑–∞—è–≤–∫–∏ –æ—Ç —Ç–∏–ø–∞ "–ü—Ä–∏–Ω–∞–¥–ª–µ–∂–∞—Ç –ª–∏ –¥–≤–∞ –µ–ª–µ–º–µ–Ω—Ç–∞ –Ω–∞ –µ–¥–Ω–∞ –∏ —Å—ä—â–∞ –≥—Ä—É–ø–∞?" –∏–ª–∏ "–û–±–µ–¥–∏–Ω–∏ –≥—Ä—É–ø–∏—Ç–µ –Ω–∞ –¥–≤–∞ –µ–ª–µ–º–µ–Ω—Ç–∞".

---

## 1. –û—Å–Ω–æ–≤–Ω–∏ –û–ø–µ—Ä–∞—Ü–∏–∏

DSU –ø–æ–¥–¥—ä—Ä–∂–∞ –¥–≤–µ –æ—Å–Ω–æ–≤–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏:

1.  **Find(i)**: –û–ø—Ä–µ–¥–µ–ª—è –≤ –∫–æ–µ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å–µ –Ω–∞–º–∏—Ä–∞ –µ–ª–µ–º–µ–Ω—Ç—ä—Ç $i$. –û–±–∏–∫–Ω–æ–≤–µ–Ω–æ –≤—Ä—ä—â–∞ "–ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª" (–∫–æ—Ä–µ–Ω) –Ω–∞ —Ç–æ–≤–∞ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ. –ê–∫–æ `find(i) == find(j)`, —Ç–æ $i$ –∏ $j$ —Å–∞ –≤ –µ–¥–Ω–æ –∏ —Å—ä—â–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ. –¢–∞–∑–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –µ –æ—Å–Ω–æ–≤–∞—Ç–∞ –∑–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç –∫—ä–º –º–Ω–æ–∂–µ—Å—Ç–≤–æ.

2.  **Union(i, j)**: –û–±–µ–¥–∏–Ω—è–≤–∞ –ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–∞—Ç–∞, –≤ –∫–æ–∏—Ç–æ —Å–µ –Ω–∞–º–∏—Ä–∞—Ç $i$ –∏ $j$. –°–ª–µ–¥ —Ç–∞–∑–∏ –æ–ø–µ—Ä–∞—Ü–∏—è, –≤—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –æ—Ç –¥–≤–µ—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —â–µ –∏–º–∞—Ç –æ–±—â –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª.

–î–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–æ–∏—Ç–æ —á–µ—Å—Ç–æ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞—Ç:
- **MakeSet(i)**: –°—ä–∑–¥–∞–≤–∞ –Ω–æ–≤–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ —Å –µ–¥–∏–Ω –µ–ª–µ–º–µ–Ω—Ç $i$.
- **GetSize(i)**: –í—Ä—ä—â–∞ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ—Ç–æ, —Å—ä–¥—ä—Ä–∂–∞—â–æ –µ–ª–µ–º–µ–Ω—Ç $i$.
- **CountSets()**: –í—Ä—ä—â–∞ –æ–±—â–∏—è –±—Ä–æ–π –Ω–∞ –æ—Ç–¥–µ–ª–Ω–∏—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞.

---

## 2. –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

–ù–∞–∏–≤–Ω–∞—Ç–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –º–æ–∂–µ –¥–∞ –¥–æ–≤–µ–¥–µ –¥–æ –≤–µ—Ä–∏–≥–∏ —Å –¥—ä–ª–∂–∏–Ω–∞ $O(N)$. –ó–∞ –¥–∞ –ø–æ—Å—Ç–∏–≥–Ω–µ–º –ø–æ—á—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ –≤—Ä–µ–º–µ, –∏–∑–ø–æ–ª–∑–≤–∞–º–µ –¥–≤–µ –≤–∞–∂–Ω–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏. –ë–µ–∑ —Ç–µ–∑–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –≤ –Ω–∞–π-–ª–æ—à–∏—è —Å–ª—É—á–∞–π –º–æ–∂–µ–º –¥–∞ –ø–æ–ª—É—á–∏–º –¥—ä–ª–±–æ–∫–æ –¥—ä—Ä–≤–æ, –∫–æ–µ—Ç–æ –ø—Ä–∞–≤–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ç–∞ `find` –ª–∏–Ω–µ–π–Ω–∞ –ø–æ –≤—Ä–µ–º–µ.

### 2.1. –°–≤–∏–≤–∞–Ω–µ –Ω–∞ –ø—ä—Ç–∏—â–∞—Ç–∞ (Path Compression)

–ü—Ä–∏ –≤—Å—è–∫–æ –∏–∑–≤–∏–∫–≤–∞–Ω–µ –Ω–∞ `find(i)`, –ø—Ä–∞–≤–∏–º –≤—Å–∏—á–∫–∏ –≤—ä–∑–ª–∏ –ø–æ –ø—ä—Ç—è –∫—ä–º –∫–æ—Ä–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–Ω–∏ –¥–µ—Ü–∞ –Ω–∞ –∫–æ—Ä–µ–Ω–∞. –¢–∞–∑–∏ —Ç–µ—Ö–Ω–∏–∫–∞ –µ –∏–∑–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–∞ - –∫–æ–≥–∞—Ç–æ —Ç—ä—Ä—Å–∏–º –∫–æ—Ä–µ–Ω–∞ –Ω–∞ –¥–∞–¥–µ–Ω –µ–ª–µ–º–µ–Ω—Ç, –≤—Å–∏—á–∫–∏ –µ–ª–µ–º–µ–Ω—Ç–∏ –ø–æ –ø—ä—Ç—è —Å–µ "—Å–≤–∏–≤–∞—Ç" –∏ –∑–∞–ø–æ—á–≤–∞—Ç –¥–∞ —Å–æ—á–∞—Ç –¥–∏—Ä–µ–∫—Ç–Ω–æ –∫—ä–º –∫–æ—Ä–µ–Ω–∞.

**–ö–∞–∫ —Ä–∞–±–æ—Ç–∏:** –ö–æ–≥–∞—Ç–æ —Ç—ä—Ä—Å–∏–º `find(i)` –∏ –º–∏–Ω–∞–≤–∞–º–µ –ø—Ä–µ–∑ –≤–µ—Ä–∏–≥–∞ –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª–∏ `i ‚Üí p1 ‚Üí p2 ‚Üí ... ‚Üí root`, —Å–ª–µ–¥ –∑–∞–≤—ä—Ä—à–≤–∞–Ω–µ –Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è—Ç–∞ –≤—Å–∏—á–∫–∏ —Ç–µ–∑–∏ –º–µ–∂–¥–∏–Ω–Ω–∏ –≤—ä–∑–ª–∏ `p1, p2, ...` –≤–µ—á–µ —Å–æ—á–∞—Ç –¥–∏—Ä–µ–∫—Ç–Ω–æ –∫—ä–º `root`.

–¢–∞–∑–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–∞–≤–∏ —Å–ª–µ–¥–≤–∞—â–∏—Ç–µ –∑–∞—è–≤–∫–∏ –∑–∞ —Å—ä—â–∏—Ç–µ –µ–ª–µ–º–µ–Ω—Ç–∏ –º–Ω–æ–≥–æ –ø–æ-–±—ä—Ä–∑–∏, —Ç—ä–π –∫–∞—Ç–æ –ø—ä—Ç—è—Ç –¥–æ –∫–æ—Ä–µ–Ω–∞ —Å—Ç–∞–≤–∞ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –¥–∏—Ä–µ–∫—Ç–µ–Ω.

### 2.2. –û–±–µ–¥–∏–Ω—è–≤–∞–Ω–µ –ø–æ —Ä–∞–Ω–≥/—Ä–∞–∑–º–µ—Ä (Union by Rank/Size)

–í–∏–Ω–∞–≥–∏ –∑–∞–∫–∞—á–∞–º–µ "–ø–æ-–ø–ª–∏—Ç–∫–æ—Ç–æ" –¥—ä—Ä–≤–æ –∫—ä–º –∫–æ—Ä–µ–Ω–∞ –Ω–∞ "–ø–æ-–¥—ä–ª–±–æ–∫–æ—Ç–æ", –∑–∞ –¥–∞ –∑–∞–ø–∞–∑–∏–º –≤–∏—Å–æ—á–∏–Ω–∞—Ç–∞ –º–∏–Ω–∏–º–∞–ª–Ω–∞. –ò–º–∞ –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞:

- **Union by Size**: –ó–∞–∫–∞—á–∞–º–µ –ø–æ-–º–∞–ª–∫–æ—Ç–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∫—ä–º –ø–æ-–≥–æ–ª—è–º–æ—Ç–æ.
- **Union by Rank**: –ó–∞–∫–∞—á–∞–º–µ –¥—ä—Ä–≤–æ—Ç–æ —Å –ø–æ-–º–∞–ª–∫–∞ –≤–∏—Å–æ—á–∏–Ω–∞ –∫—ä–º –¥—ä—Ä–≤–æ—Ç–æ —Å –ø–æ-–≥–æ–ª—è–º–∞ –≤–∏—Å–æ—á–∏–Ω–∞.

–ò –¥–≤–µ—Ç–µ –¥–∞–≤–∞—Ç –æ—Ç–ª–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏, –∫–∞—Ç–æ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ union by size –µ –ø–æ-–ø–æ–ø—É–ª—è—Ä–µ–Ω, –∑–∞—â–æ—Ç–æ —Ä–∞–∑–º–µ—Ä—ä—Ç –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞—Ç–∞ —á–µ—Å—Ç–æ –µ –ø–æ–ª–µ–∑–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∞–º –ø–æ —Å–µ–±–µ —Å–∏.

```cpp
struct DSU {
    vector<int> parent;  // parent[i] –ø–∞–∑–∏ —Ä–æ–¥–∏—Ç–µ–ª—è –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç i
    vector<int> sz;      // sz[i] –ø–∞–∑–∏ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ—Ç–æ —Å –∫–æ—Ä–µ–Ω i

    // –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    DSU(int n) {
        parent.resize(n + 1);
        sz.resize(n + 1, 1);
        // –í—Å–µ–∫–∏ –µ–ª–µ–º–µ–Ω—Ç –µ –≤ —Å–≤–æ–µ —Å–æ–±—Å—Ç–≤–µ–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ
        for (int i = 1; i <= n; i++) parent[i] = i;
    }

    // Find —Å path compression
    int find(int i) {
        if (parent[i] == i) return i;
        return parent[i] = find(parent[i]); // Path compression
    }

    // Union –ø–æ —Ä–∞–∑–º–µ—Ä
    void unite(int i, int j) {
        int root_i = find(i);
        int root_j = find(j);
        if (root_i != root_j) {
            // –í–∏–Ω–∞–≥–∏ –∑–∞–∫–∞—á–∞–º–µ –ø–æ-–º–∞–ª–∫–æ—Ç–æ –∫—ä–º –ø–æ-–≥–æ–ª—è–º–æ—Ç–æ
            if (sz[root_i] < sz[root_j]) swap(root_i, root_j);
            parent[root_j] = root_i;
            sz[root_i] += sz[root_j];
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–ª–∏ –¥–≤–∞ –µ–ª–µ–º–µ–Ω—Ç–∞ —Å–∞ –≤ –µ–¥–Ω–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ
    bool same(int i, int j) {
        return find(i) == find(j);
    }

    // –ü–æ–ª—É—á–∞–≤–∞–Ω–µ –Ω–∞ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–æ—Ç–æ
    int getSize(int i) {
        return sz[find(i)];
    }
};
```

**–°–ª–æ–∂–Ω–æ—Å—Ç**: –° –¥–≤–µ—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏, –æ–ø–µ—Ä–∞—Ü–∏–∏—Ç–µ —Å–∞ –ø–æ—á—Ç–∏ $O(1)$ (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ $O(\alpha(N))$, –∫—ä–¥–µ—Ç–æ $\alpha$ –µ –æ–±—Ä–∞—Ç–Ω–∞—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –Ω–∞ –ê–∫–µ—Ä–º–∞–Ω). –ù–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞ $\alpha(N) \leq 4$ –∑–∞ –≤—Å–∏—á–∫–∏ —Ä–µ–∞–ª–Ω–∏ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –Ω–∞ $N$, –∫–æ–µ—Ç–æ –ø—Ä–∞–≤–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏—Ç–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∏.

### 2.3. –í–∞—Ä–∏–∞–Ω—Ç —Å —Ä–∞–Ω–≥

–ê–∫–æ –ø—Ä–µ–¥–ø–æ—á–∏—Ç–∞—Ç–µ union by rank –≤–º–µ—Å—Ç–æ union by size:

```cpp
struct DSU_Rank {
    vector<int> parent;
    vector<int> rank;  // rank[i] –µ –ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª–Ω–∞—Ç–∞ –≤–∏—Å–æ—á–∏–Ω–∞ –Ω–∞ –¥—ä—Ä–≤–æ—Ç–æ

    DSU_Rank(int n) {
        parent.resize(n + 1);
        rank.resize(n + 1, 0);
        for (int i = 1; i <= n; i++) parent[i] = i;
    }

    int find(int i) {
        if (parent[i] == i) return i;
        return parent[i] = find(parent[i]);
    }

    void unite(int i, int j) {
        int root_i = find(i);
        int root_j = find(j);
        if (root_i != root_j) {
            if (rank[root_i] < rank[root_j]) {
                parent[root_i] = root_j;
            } else if (rank[root_i] > rank[root_j]) {
                parent[root_j] = root_i;
            } else {
                parent[root_j] = root_i;
                rank[root_i]++;  // –£–≤–µ–ª–∏—á–∞–≤–∞–º–µ —Ä–∞–Ω–≥–∞ —Å–∞–º–æ –ø—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ
            }
        }
    }
};
```

---

## 3. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

DSU –µ –Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å –º–Ω–æ–≥–æ–±—Ä–æ–π–Ω–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Ä–∞–∑–ª–∏—á–Ω–∏ –æ–±–ª–∞—Å—Ç–∏.

### 3.1. –ê–ª–≥–æ—Ä–∏—Ç—ä–º –Ω–∞ –ö—Ä—É—Å–∫–∞–ª (Minimum Spanning Tree)

–ê–ª–≥–æ—Ä–∏—Ç—ä–º—ä—Ç –Ω–∞ –ö—Ä—É—Å–∫–∞–ª –Ω–∞–º–∏—Ä–∞ –º–∏–Ω–∏–º–∞–ª–Ω–æ –ø–æ–∫—Ä–∏–≤–∞—â–æ –¥—ä—Ä–≤–æ –≤ –ø—Ä–µ—Ç–µ–≥–ª–µ–Ω –≥—Ä–∞—Ñ. DSU –µ —Ü–µ–Ω—Ç—Ä–∞–ª–Ω–∞ —á–∞—Å—Ç –æ—Ç —Ç–æ–∑–∏ –∞–ª–≥–æ—Ä–∏—Ç—ä–º:

```cpp
struct Edge {
    int u, v, weight;
    bool operator<(const Edge& other) const {
        return weight < other.weight;
    }
};

long long kruskal(int n, vector<Edge>& edges) {
    sort(edges.begin(), edges.end()); // –°–æ—Ä—Ç–∏—Ä–∞–º–µ –ø–æ —Ç–µ–≥–ª–æ
    DSU dsu(n);
    long long total_weight = 0;
    int edges_added = 0;

    for (const Edge& e : edges) {
        // –î–æ–±–∞–≤—è–º–µ —Ä–µ–±—Ä–æ —Å–∞–º–æ –∞–∫–æ –Ω–µ —Å—ä–∑–¥–∞–≤–∞ —Ü–∏–∫—ä–ª
        if (!dsu.same(e.u, e.v)) {
            dsu.unite(e.u, e.v);
            total_weight += e.weight;
            edges_added++;
            if (edges_added == n - 1) break; // MST –∏–º–∞ n-1 —Ä–µ–±—Ä–∞
        }
    }
    return total_weight;
}
```

**–û–±—è—Å–Ω–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –¥–∞–ª–∏ –¥–≤–∞—Ç–∞ –≤—ä—Ä—Ö–∞ –Ω–∞ —Ä–µ–±—Ä–æ—Ç–æ —Å–∞ –≤ —Ä–∞–∑–ª–∏—á–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏. –ê–∫–æ —Å–∞, –¥–æ–±–∞–≤—è–º–µ —Ä–µ–±—Ä–æ—Ç–æ, –∑–∞—â–æ—Ç–æ —Ç–æ –Ω–µ —Å—ä–∑–¥–∞–≤–∞ —Ü–∏–∫—ä–ª.

### 3.2. –°–≤—ä—Ä–∑–∞–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏

–ë—Ä–æ—è—Ç –Ω–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –µ —Ä–∞–≤–µ–Ω –Ω–∞ –±—Ä–æ—è –µ–ª–µ–º–µ–Ω—Ç–∏ $i$, –∑–∞ –∫–æ–∏—Ç–æ `parent[i] == i`. –¢–æ–≤–∞ —Å–∞ –∫–æ—Ä–µ–Ω–∏—Ç–µ –Ω–∞ —Ä–∞–∑–ª–∏—á–Ω–∏—Ç–µ –º–Ω–æ–∂–µ—Å—Ç–≤–∞.

```cpp
int countComponents(DSU& dsu, int n) {
    int count = 0;
    for (int i = 1; i <= n; i++) {
        if (dsu.find(i) == i) {
            count++;
        }
    }
    return count;
}
```

–ê–ª—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ, –º–æ–∂–µ–º –¥–∞ –ø–æ–¥–¥—ä—Ä–∂–∞–º–µ –±—Ä–æ—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –¥–∏—Ä–µ–∫—Ç–Ω–æ –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞:

```cpp
struct DSU_WithCount {
    vector<int> parent, sz;
    int components;

    DSU_WithCount(int n) {
        parent.resize(n + 1);
        sz.resize(n + 1, 1);
        components = n;
        for (int i = 1; i <= n; i++) parent[i] = i;
    }

    int find(int i) {
        if (parent[i] == i) return i;
        return parent[i] = find(parent[i]);
    }

    void unite(int i, int j) {
        int root_i = find(i);
        int root_j = find(j);
        if (root_i != root_j) {
            if (sz[root_i] < sz[root_j]) swap(root_i, root_j);
            parent[root_j] = root_i;
            sz[root_i] += sz[root_j];
            components--;  // –ù–∞–º–∞–ª—è–≤–∞ —Å 1 –ø—Ä–∏ –≤—Å—è–∫–æ –æ–±–µ–¥–∏–Ω—è–≤–∞–Ω–µ
        }
    }

    int getComponents() {
        return components;
    }
};
```

### 3.3. –î–∏–Ω–∞–º–∏—á–Ω–∞ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç

–ú–æ–∂–µ–º –¥–∞ –¥–æ–±–∞–≤—è–º–µ —Ä–µ–±—Ä–∞ –∏ –¥–∞ –ø—Ä–æ–≤–µ—Ä—è–≤–∞–º–µ –∑–∞ –ø—ä—Ç –º–µ–∂–¥—É –¥–≤–∞ –≤—ä—Ä—Ö–∞ –≤ —Ä–µ–∞–ª–Ω–æ –≤—Ä–µ–º–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ –æ–Ω–ª–∞–π–Ω –∑–∞—è–≤–∫–∏:

```cpp
void processQueries(int n, vector<pair<int,int>>& queries) {
    DSU dsu(n);
    
    for (auto [type, a, b] : queries) {
        if (type == 1) {
            // –î–æ–±–∞–≤–∏ —Ä–µ–±—Ä–æ –º–µ–∂–¥—É a –∏ b
            dsu.unite(a, b);
        } else {
            // –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞–ª–∏ a –∏ b —Å–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏
            if (dsu.same(a, b)) {
                cout << "YES\n";
            } else {
                cout << "NO\n";
            }
        }
    }
}
```

### 3.4. –û—Ç–∫—Ä–∏–≤–∞–Ω–µ –Ω–∞ —Ü–∏–∫–ª–∏

–í –Ω–µ–Ω–∞—Å–æ—á–µ–Ω –≥—Ä–∞—Ñ –º–æ–∂–µ–º –¥–∞ –æ—Ç–∫—Ä–∏–≤–∞–º–µ —Ü–∏–∫–ª–∏:

```cpp
bool hasCycle(int n, vector<pair<int,int>>& edges) {
    DSU dsu(n);
    for (auto [u, v] : edges) {
        if (dsu.same(u, v)) {
            return true;  // –ù–∞–º–µ—Ä–µ–Ω –µ —Ü–∏–∫—ä–ª
        }
        dsu.unite(u, v);
    }
    return false;
}
```

### 3.5. –ó–∞–¥–∞—á–∏ –∑–∞ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç –Ω–∞ –º—Ä–µ–∂–∞

–ß–µ—Å—Ç–æ —Å–µ –∏–∑–ø–æ–ª–∑–≤–∞ –∑–∞ –∑–∞–¥–∞—á–∏ —Ç–∏–ø "–¥–∞–ª–∏ –º—Ä–µ–∂–∞—Ç–∞ –µ —Å–≤—ä—Ä–∑–∞–Ω–∞ —Å–ª–µ–¥ –¥–æ–±–∞–≤—è–Ω–µ/–ø—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ –≤—Ä—ä–∑–∫–∏", "–Ω–∞–º–∏—Ä–∞–Ω–µ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏ –≤—Ä—ä–∑–∫–∏" –∏ —Ç.–Ω.

## 4. –†–∞–∑—à–∏—Ä–µ–Ω–∏ —Ç–µ—Ö–Ω–∏–∫–∏ –∏ –≤–∞—Ä–∏–∞–Ω—Ç–∏

### 4.1. DSU —Å rollback (Undo –æ–ø–µ—Ä–∞—Ü–∏–∏)

–í –Ω—è–∫–æ–∏ –∑–∞–¥–∞—á–∏ –º–æ–∂–µ –¥–∞ —Å–µ –Ω–∞–ª–æ–∂–∏ –¥–∞ "–æ—Ç–º–µ–Ω—è–º–µ" –æ–ø–µ—Ä–∞—Ü–∏–∏ unite. –¢–æ–≤–∞ –∏–∑–∏—Å–∫–≤–∞ –º–∞–ª–∫–æ –ø–æ-—Ä–∞–∑–ª–∏—á–Ω–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è –±–µ–∑ path compression:

```cpp
struct DSU_Rollback {
    vector<int> parent, rank;
    stack<pair<int, int>> history;  // –ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –ø—Ä–æ–º–µ–Ω–∏

    DSU_Rollback(int n) {
        parent.resize(n + 1);
        rank.resize(n + 1, 0);
        for (int i = 1; i <= n; i++) parent[i] = i;
    }

    int find(int i) {
        // –ë–µ–∑ path compression –∑–∞ –¥–∞ –º–æ–∂–µ rollback
        while (parent[i] != i) i = parent[i];
        return i;
    }

    void unite(int i, int j) {
        int root_i = find(i);
        int root_j = find(j);
        if (root_i == root_j) return;
        
        if (rank[root_i] < rank[root_j]) swap(root_i, root_j);
        history.push({root_j, parent[root_j]});
        parent[root_j] = root_i;
        
        if (rank[root_i] == rank[root_j]) {
            history.push({root_i, rank[root_i]});
            rank[root_i]++;
        }
    }

    void rollback() {
        // –û—Ç–º–µ–Ω—è–º–µ –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è
        if (history.empty()) return;
        auto [node, value] = history.top();
        history.pop();
        // –õ–æ–≥–∏–∫–∞ –∑–∞ –≤—Ä—ä—â–∞–Ω–µ...
    }
};
```

### 4.2. Persistent DSU

–ó–∞–ø–∞–∑–≤–∞ –ø—Ä–µ–¥–∏—à–Ω–∏ –≤–µ—Ä—Å–∏–∏ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞—Ç–∞, –ø–æ–∑–≤–æ–ª—è–≤–∞–π–∫–∏ –∑–∞—è–≤–∫–∏ –∑–∞ —Ä–∞–∑–ª–∏—á–Ω–∏ –º–æ–º–µ–Ω—Ç–∏ –≤—ä–≤ –≤—Ä–µ–º–µ—Ç–æ.

### 4.3. DSU —Å –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

–ú–æ–∂–µ–º –¥–∞ –ø–∞–∑–∏–º –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∑–∞ –≤—Å—è–∫–æ –º–Ω–æ–∂–µ—Å—Ç–≤–æ:

```cpp
struct DSU_Extended {
    vector<int> parent, sz;
    vector<long long> sum;  // –°—É–º–∞ –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∏—Ç–µ –≤ –º–Ω–æ–∂–µ—Å—Ç–≤–æ—Ç–æ

    DSU_Extended(int n, vector<int>& values) {
        parent.resize(n + 1);
        sz.resize(n + 1, 1);
        sum.resize(n + 1);
        for (int i = 1; i <= n; i++) {
            parent[i] = i;
            sum[i] = values[i];
        }
    }

    int find(int i) {
        if (parent[i] == i) return i;
        return parent[i] = find(parent[i]);
    }

    void unite(int i, int j) {
        int root_i = find(i);
        int root_j = find(j);
        if (root_i != root_j) {
            if (sz[root_i] < sz[root_j]) swap(root_i, root_j);
            parent[root_j] = root_i;
            sz[root_i] += sz[root_j];
            sum[root_i] += sum[root_j];  // –û–±–µ–¥–∏–Ω—è–≤–∞–º–µ —Å—É–º–∏—Ç–µ
        }
    }

    long long getSum(int i) {
        return sum[find(i)];
    }
};
```

## 5. –¢–∏–ø–∏—á–Ω–∏ –≥—Ä–µ—à–∫–∏ –∏ —Å—ä–≤–µ—Ç–∏

### 5.1. –ß–µ—Å—Ç–æ —Å—Ä–µ—â–∞–Ω–∏ –≥—Ä–µ—à–∫–∏

1. **–ó–∞–±—Ä–∞–≤—è–Ω–µ –Ω–∞ path compression:** –í–æ–¥–∏ –¥–æ –±–∞–≤–Ω–∞ —Ä–∞–±–æ—Ç–∞
2. **–ù–µ–ø—Ä–∞–≤–∏–ª–Ω–æ –æ–±–µ–¥–∏–Ω—è–≤–∞–Ω–µ:** –û–±–µ–¥–∏–Ω—è–≤–∞–Ω–µ –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∏ –≤–º–µ—Å—Ç–æ —Ç–µ—Ö–Ω–∏—Ç–µ –∫–æ—Ä–µ–Ω–∏
3. **–ò–Ω–¥–µ–∫—Å–∞—Ü–∏—è:** –ó–∞–±—Ä–∞–≤—è–Ω–µ —á–µ —Ä–∞–±–æ—Ç–∏–º —Å 0-based –∏–ª–∏ 1-based –∏–Ω–¥–µ–∫—Å–∏
4. **–†–µ–∫—É—Ä—Å–∏—è –±–µ–∑ base case:** –ó–∞–±—Ä–∞–≤—è–Ω–µ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ `if (parent[i] == i)`

### 5.2. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ —Å—ä–≤–µ—Ç–∏

- –í–∏–Ω–∞–≥–∏ –∏–∑–ø–æ–ª–∑–≤–∞–π—Ç–µ –∏ –¥–≤–µ—Ç–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (path compression + union by size/rank)
- –ó–∞ –ø–æ-–ª–µ—Å–Ω–æ –¥–µ–±—ä–≥–≤–∞–Ω–µ, –¥–æ–±–∞–≤–µ—Ç–µ –º–µ—Ç–æ–¥ `print()` –∫–æ–π—Ç–æ –ø–æ–∫–∞–∑–≤–∞ —Ç–µ–∫—É—â–æ—Ç–æ —Å—ä—Å—Ç–æ—è–Ω–∏–µ
- –ü—Ä–∏ –∑–∞–¥–∞—á–∏ —Å –≥–æ–ª–µ–º–∏ —á–∏—Å–ª–∞, –≤–Ω–∏–º–∞–≤–∞–π—Ç–µ –¥–∞ –Ω–µ –ø—Ä–µ–ø—ä–ª–Ω–∏—Ç–µ —Ç–∏–ø–æ–≤–µ—Ç–µ –¥–∞–Ω–Ω–∏
- –¢–µ—Å—Ç–≤–∞–π—Ç–µ —Å –º–∞–ª–∫–∏ –ø—Ä–∏–º–µ—Ä–∏ –∑–∞ –¥–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç–µ –∫–æ—Ä–µ–∫—Ç–Ω–æ—Å—Ç—Ç–∞

## 6. –ó–∞–¥–∞—á–∏ –∑–∞ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω–∏ –∑–∞–¥–∞—á–∏
1.  **CSES Road Construction**: –ü–æ–¥–¥—ä—Ä–∂–∞–Ω–µ –Ω–∞ –±—Ä–æ—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –∏ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –Ω–∞–π-–≥–æ–ª–µ–º–∏—è. –ú–Ω–æ–≥–æ –¥–æ–±—Ä–∞ –∑–∞–¥–∞—á–∞ –∑–∞ –Ω–∞—á–∞–ª–æ.
2.  **SPOJ MST**: –ö–ª–∞—Å–∏—á–µ—Å–∫–∏ MST —Å –∞–ª–≥–æ—Ä–∏—Ç—ä–º –Ω–∞ –ö—Ä—É—Å–∫–∞–ª.
3.  **Codeforces 25D**: Roads not only in Berland - –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞ –∑–∞–¥–∞—á–∞ –∑–∞ –ø—Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–∞–Ω–µ –Ω–∞ –≥—Ä–∞—Ñ.

### –°—Ä–µ–¥–Ω–∏ –∑–∞–¥–∞—á–∏
4.  **Codeforces 277A**: Learning Languages - –∑–∞–¥–∞—á–∞ –∑–∞ —Å–≤—ä—Ä–∑–∞–Ω–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏.
5.  **CSES Road Reparation**: MST —Å –ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç.
6.  **AtCoder ABC 120D**: Bridges - –∑–∞–¥–∞—á–∞ –∑–∞ –¥–∏–Ω–∞–º–∏—á–Ω–∞ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç.

### –ù–∞–ø—Ä–µ–¥–Ω–∞–ª–∏ –∑–∞–¥–∞—á–∏
7.  **Codeforces 400D**: Dima and Bacteria - DSU —Å –¥–æ–ø—ä–ª–Ω–∏—Ç–µ–ª–Ω–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è.
8.  **SPOJ KOZE**: Sheep - 2D DSU –∑–∞ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç –≤ –º–∞—Ç—Ä–∏—Ü–∞.
9.  **Codeforces 763C**: Timofey and rectangles - –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ DSU.

## üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

DSU –µ –µ–¥–Ω–∞ –æ—Ç –Ω–∞–π-–≤–∞–∂–Ω–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –≤ —Å—ä—Å—Ç–µ–∑–∞—Ç–µ–ª–Ω–æ—Ç–æ –ø—Ä–æ–≥—Ä–∞–º–∏—Ä–∞–Ω–µ. –¢—è –µ:
- **–ò–∑–∫–ª—é—á–∏—Ç–µ–ª–Ω–æ –±—ä—Ä–∑–∞**: –ü–æ—á—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∏ –æ–ø–µ—Ä–∞—Ü–∏–∏ –±–ª–∞–≥–æ–¥–∞—Ä–µ–Ω–∏–µ –Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏—Ç–µ
- **–õ–µ—Å–Ω–∞ –∑–∞ –ø–∏—Å–∞–Ω–µ**: –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—è—Ç–∞ –µ –∫—Ä–∞—Ç–∫–∞ –∏ —è—Å–Ω–∞
- **–£–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∞**: –ü—Ä–∏–ª–∞–≥–∞ —Å–µ –≤ –æ–≥—Ä–æ–º–µ–Ω –±—Ä–æ–π —Ä–∞–∑–ª–∏—á–Ω–∏ –∑–∞–¥–∞—á–∏

DSU —á–µ—Å—Ç–æ –µ "—Å–∫—Ä–∏—Ç–æ—Ç–æ" —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –∑–∞–¥–∞—á–∏, –∫–æ–∏—Ç–æ –Ω–∞ –ø—Ä—ä–≤ –ø–æ–≥–ª–µ–¥ –Ω–µ –∏–∑–≥–ª–µ–∂–¥–∞—Ç —Å–≤—ä—Ä–∑–∞–Ω–∏ —Å –≥—Ä–∞—Ñ–∏. –ö–æ–≥–∞—Ç–æ –≤–∏–¥–∏—Ç–µ –∑–∞–¥–∞—á–∞ –∑–∞ –≥—Ä—É–ø–∏—Ä–∞–Ω–µ –Ω–∞ –µ–ª–µ–º–µ–Ω—Ç–∏ –∏–ª–∏ –ø–æ–¥–¥—ä—Ä–∂–∞–Ω–µ –Ω–∞ –µ–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç –º–µ–∂–¥—É –æ–±–µ–∫—Ç–∏, –ø–æ–º–∏—Å–ª–µ—Ç–µ –∑–∞ DSU!

–ù–∞—É—á–µ—Ç–µ –¥–æ–±—Ä–µ —Ç–∞–∑–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - —Ç—è —â–µ –≤–∏ —Å–ø–µ—Å—Ç–∏ –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ –∏ —â–µ –≤–∏ –ø–æ–º–æ–≥–Ω–µ –¥–∞ —Ä–µ—à–∞–≤–∞—Ç–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å–ª–æ–∂–Ω–∏ –ø—Ä–æ–±–ª–µ–º–∏ –∑–∞ —Å–≤—ä—Ä–∑–∞–Ω–æ—Å—Ç –∏ –æ–±–µ–¥–∏–Ω—è–≤–∞–Ω–µ –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞.
